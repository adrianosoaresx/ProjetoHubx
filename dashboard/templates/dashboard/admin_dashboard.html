{% extends "base.html" %}
{% load i18n static %}

{% block title %}{% trans "Dashboard administrativo" %}{% endblock %}

{% block hero %}
{% include "_components/hero.html" with title=_("Dashboard administrativo") subtitle=_("Acompanhe indicadores-chave da organização e o desempenho dos eventos.") breadcrumb_template="dashboard/partials/admin_dashboard_breadcrumb.html" neural_background="dashboard" section_classes="relative isolate overflow-hidden text-white" container_classes="max-w-7xl mx-auto w-full px-6 py-14 md:py-16" %}

{% endblock %}

{% block content %}
  <div class="mx-auto flex w-full max-w-7xl flex-col gap-10">
    <section aria-labelledby="dashboard-metrics-title" class="space-y-6">
      <div class="flex items-center justify-between gap-4">
        <h2 id="dashboard-metrics-title" class="text-xl font-semibold text-[var(--text-primary)]">
          {% trans "Métricas principais" %}
        </h2>
        <p class="text-sm text-[var(--text-muted)]">
          {% trans "Visão geral do crescimento da comunidade e atividades em andamento." %}
        </p>
      </div>
      <div class="grid gap-4 sm:grid-cols-2 xl:grid-cols-3">
        {% include "_partials/cards/total_card.html" with label=_("Associados") valor=total_associados icon_name="users" %}
        {% include "_partials/cards/total_card.html" with label=_("Nucleados") valor=total_nucleados icon_name="network" %}
        {% include "_partials/cards/total_card.html" with label=_("Eventos ativos") valor=eventos_ativos icon_name="activity" %}
      </div>
    </section>

    <section aria-labelledby="dashboard-charts-title" class="space-y-6 pt-4 md:pt-6">
      <div class="flex items-center justify-between gap-4">
        <h2 id="dashboard-charts-title" class="text-xl font-semibold text-[var(--text-primary)]">
          {% trans "Visualizações" %}
        </h2>
        <p class="text-sm text-[var(--text-muted)]">
          {% trans "Explore a distribuição de membros e a participação dos núcleos nos eventos." %}
        </p>
      </div>
      <div class="grid gap-6 lg:grid-cols-2">
        <figure class="card" aria-labelledby="membros-chart-title">
          <div class="card-body space-y-6">
            <div
              id="membros-chart"
              role="img"
              aria-label="{% trans 'Gráfico de pizza apresentando a proporção de associados nucleados e não nucleados.' %}"
              class="h-80 w-full rounded-md border border-[var(--border-subtle)] bg-white"
            ></div>
            {{ membros_chart.figure|json_script:"membros-chart-data" }}
            <figcaption class="space-y-1">
              <h3 id="membros-chart-title" class="text-lg font-semibold text-[var(--text-primary)]">
                {% trans "Distribuição de membros" %}
              </h3>
              <p class="text-sm text-[var(--text-muted)]">
                {% trans "Comparativo entre associados nucleados e não nucleados." %}
              </p>
            </figcaption>
          </div>
        </figure>

        <figure class="card" aria-labelledby="eventos-nucleo-chart-title">
          <div class="card-body space-y-6">
            <div
              id="eventos-nucleo-chart"
              role="img"
              aria-label="{% trans 'Gráfico de barras com a distribuição de eventos por núcleo e eventos públicos.' %}"
              class="h-80 w-full rounded-md border border-[var(--border-subtle)] bg-white"
            ></div>
            {{ eventos_por_nucleo.figure|json_script:"eventos-nucleo-chart-data" }}
            <figcaption class="space-y-1">
              <h3 id="eventos-nucleo-chart-title" class="text-lg font-semibold text-[var(--text-primary)]">
                {% trans "Eventos por núcleo" %}
              </h3>
              <p class="text-sm text-[var(--text-muted)]">
                {% trans "Quantidade de eventos por núcleo, incluindo iniciativas públicas." %}
              </p>
            </figcaption>
          </div>
        </figure>
      </div>
    </section>
  </div>
{% endblock %}
{% block extra_js %}
  {{ block.super }}
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js" defer></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      function renderPlotlyChart(containerId, dataScriptId) {
        const container = document.getElementById(containerId);
        const script = document.getElementById(dataScriptId);
        if (!container || !script) {
          return;
        }

        let figure;
        try {
          figure = JSON.parse(script.textContent);
        } catch (error) {
          console.error("Não foi possível interpretar os dados do gráfico", error);
          return;
        }

        if (typeof Plotly === "undefined") {
          console.warn("Plotly não está disponível para renderizar o gráfico", containerId);
          return;
        }

        const data = figure?.data ?? [];
        const layout = figure?.layout ?? {};
        const config = {
          responsive: true,
          displayModeBar: false,
        };

        Plotly.newPlot(container, data, layout, config);
      }

      renderPlotlyChart("membros-chart", "membros-chart-data");
      renderPlotlyChart("eventos-nucleo-chart", "eventos-nucleo-chart-data");
    });
  </script>
{% endblock %}
