{% load i18n %}
<form method="get" class="mb-6 flex flex-wrap gap-4 items-end" aria-label="{% trans 'Filtros do dashboard' %}">
  <div>
    <label for="periodo" class="block text-sm font-medium text-neutral-700">{% trans 'Período' %}</label>
    <select id="periodo" name="periodo" class="mt-1 block border-gray-300 rounded" aria-label="{% trans 'Selecionar período' %}">
      <option value="mensal" {% if periodo == 'mensal' %}selected{% endif %}>{% trans 'Mensal' %}</option>
      <option value="trimestral" {% if periodo == 'trimestral' %}selected{% endif %}>{% trans 'Trimestral' %}</option>
      <option value="semestral" {% if periodo == 'semestral' %}selected{% endif %}>{% trans 'Semestral' %}</option>
      <option value="anual" {% if periodo == 'anual' %}selected{% endif %}>{% trans 'Anual' %}</option>
    </select>
  </div>
  <div>
    <label for="escopo" class="block text-sm font-medium text-neutral-700">{% trans 'Escopo' %}</label>
    <select id="escopo" name="escopo" class="mt-1 block border-gray-300 rounded" aria-label="{% trans 'Selecionar escopo' %}">
      <option value="auto" {% if escopo == 'auto' %}selected{% endif %}>{% trans 'Automático' %}</option>
      <option value="global" {% if escopo == 'global' %}selected{% endif %}>{% trans 'Global' %}</option>
      <option value="organizacao" {% if escopo == 'organizacao' %}selected{% endif %}>{% trans 'Organização' %}</option>
      <option value="nucleo" {% if escopo == 'nucleo' %}selected{% endif %}>{% trans 'Núcleo' %}</option>
      <option value="evento" {% if escopo == 'evento' %}selected{% endif %}>{% trans 'Evento' %}</option>
    </select>
  </div>
  <div>
    <label for="organizacao_id" class="block text-sm font-medium text-neutral-700">{% trans 'Organização' %}</label>
    <select id="organizacao_id" name="organizacao_id" class="mt-1 block border-gray-300 rounded" aria-label="{% trans 'Selecionar organização' %}">
      {% for org in organizacoes_permitidas %}
      <option value="{{ org.id }}" {% if filtros.organizacao_id|default:'' == org.id|stringformat:'s' %}selected{% endif %}>{{ org.nome }}</option>
      {% endfor %}
    </select>
  </div>
  <div>
    <label for="nucleo_id" class="block text-sm font-medium text-neutral-700">{% trans 'Núcleo' %}</label>
    <select id="nucleo_id" name="nucleo_id" class="mt-1 block border-gray-300 rounded" aria-label="{% trans 'Selecionar núcleo' %}">
      {% for nucleo in nucleos_permitidos %}
      <option value="{{ nucleo.id }}" {% if filtros.nucleo_id|default:'' == nucleo.id|stringformat:'s' %}selected{% endif %}>{{ nucleo.nome }}</option>
      {% endfor %}
    </select>
  </div>
  <div>
    <label for="evento_id" class="block text-sm font-medium text-neutral-700">{% trans 'Evento' %}</label>
    <select id="evento_id" name="evento_id" class="mt-1 block border-gray-300 rounded" aria-label="{% trans 'Selecionar evento' %}">
      {% for evento in eventos_permitidos %}
      <option value="{{ evento.id }}" {% if filtros.evento_id|default:'' == evento.id|stringformat:'s' %}selected{% endif %}>{{ evento.titulo }}</option>
      {% endfor %}
    </select>
  </div>
  <div>
    <label for="data_inicio" class="block text-sm font-medium text-neutral-700">{% trans 'Data início' %}</label>
    <input type="date" id="data_inicio" name="data_inicio" value="{{ filtros.data_inicio }}" class="mt-1 border-gray-300 rounded" />
  </div>
  <div>
    <label for="data_fim" class="block text-sm font-medium text-neutral-700">{% trans 'Data fim' %}</label>
    <input type="date" id="data_fim" name="data_fim" value="{{ filtros.data_fim }}" class="mt-1 border-gray-300 rounded" />
  </div>
  <fieldset class="flex flex-col">
    <legend class="text-sm font-medium text-neutral-700">{% trans 'Métricas' %}</legend>
    <div class="flex flex-wrap gap-2 mt-1">
      {% for m in metricas_disponiveis %}
      <label class="flex items-center gap-1 text-sm">
        <input type="checkbox" name="metricas" value="{{ m.key }}" {% if m.key in metricas_selecionadas %}checked{% endif %} class="border-gray-300 rounded" />
        {{ m.label }}
      </label>
      {% endfor %}
    </div>
  </fieldset>
  <div class="flex gap-2 mt-4">
    <button type="submit" class="px-4 py-2 bg-primary-600 text-white rounded focus:outline-none focus:ring" aria-label="{% trans 'Aplicar filtros' %}">{% trans 'Filtrar' %}</button>
    {% if can_export %}
    <select name="formato" class="border-gray-300 rounded" aria-label="{% trans 'Formato de exportação' %}">
      <option value="csv">{% trans 'CSV' %}</option>
      <option value="pdf">{% trans 'PDF' %}</option>
      <option value="xlsx">{% trans 'Excel' %}</option>
      <option value="png">{% trans 'PNG' %}</option>
    </select>
    <button type="submit" formaction="{% url 'dashboard:export' %}" class="px-4 py-2 bg-neutral-200 text-neutral-800 rounded focus:outline-none focus:ring" aria-label="{% trans 'Exportar métricas' %}">{% trans 'Exportar' %}</button>
    {% endif %}
    <a href="{% url 'dashboard:filter-create' %}?{{ request.GET.urlencode }}" class="px-4 py-2 bg-neutral-200 text-neutral-800 rounded focus:outline-none focus:ring" aria-label="{% trans 'Salvar filtro rápido' %}">{% trans 'Salvar filtro' %}</a>
    <a href="{% url 'dashboard:filters' %}" class="px-4 py-2 bg-neutral-200 text-neutral-800 rounded focus:outline-none focus:ring" aria-label="{% trans 'Ver filtros salvos' %}">{% trans 'Meus filtros' %}</a>
    <a href="{% url 'dashboard:config-create' %}?{{ request.GET.urlencode }}" class="px-4 py-2 bg-neutral-200 text-neutral-800 rounded focus:outline-none focus:ring" aria-label="{% trans 'Salvar configuração' %}">{% trans 'Salvar configuração' %}</a>
  </div>
</form>
