{% load i18n %}
{% include "eventos/partials/_painel_hero_oob.html" %}
<section class="py-12 px-4">

  <div class="flex flex-col gap-6">

  {% include "eventos/partials/eventos/_nav.html" with current_section='eventos' hide_eventos=True briefing_evento=briefing_evento briefing_url=briefing_url briefing_label=briefing_label %}


    <article class="card">
      <div class="card-header">
        <h2 class="text-xl font-semibold">{% trans "Informações" %}</h2>
      </div>
      <div class="card-body space-y-2 text-sm">
        <p><strong>{% trans "Início" %}:</strong> {{ object.data_inicio|date:'SHORT_DATETIME_FORMAT' }}</p>
        <p><strong>{% trans "Fim" %}:</strong> {{ object.data_fim|date:'SHORT_DATETIME_FORMAT' }}</p>
        <p><strong>{% trans "Local" %}:</strong> {{ object.local }}</p>
        <p><strong>{% trans "Cidade" %}:</strong> {{ object.cidade }}</p>
        <p><strong>{% trans "Estado" %}:</strong> {{ object.estado }}</p>
        <p><strong>{% trans "CEP" %}:</strong> {{ object.cep }}</p>
        <p>
          <strong>{% trans "Contato" %}:</strong>
          {{ object.contato_nome }}
          {% if object.contato_email %}- {{ object.contato_email }}{% endif %}
          {% if object.contato_whatsapp %}- {{ object.contato_whatsapp }}{% endif %}
        </p>
        {% if object.participantes_maximo %}
          <p><strong>{% trans "Participantes máximo" %}:</strong> {{ object.participantes_maximo }}</p>
        {% endif %}
        {% if object.orcamento_estimado %}
          <p><strong>{% trans "Orçamento estimado" %}:</strong> {{ object.orcamento_estimado }}</p>
        {% endif %}
        {% if object.valor_gasto %}
          <p><strong>{% trans "Valor gasto" %}:</strong> {{ object.valor_gasto }}</p>
        {% endif %}
      </div>
    </article>

    {% if user.is_authenticated and user.user_type != 'admin' %}
    <article class="card">
      <div class="card-header">
        {% if inscricao and avaliacao_permitida %}
          <h2 class="text-xl font-semibold">{% trans "Avaliação" %}</h2>
        {% else %}
          <h2 class="text-xl font-semibold">{% trans "Inscrição" %}</h2>
        {% endif %}
      </div>
      <div class="card-body space-y-4">
        {% if inscricao %}
          {% if avaliacao_permitida %}
            <form method="post" action="{% url 'eventos:evento_feedback' object.pk %}" class="space-y-4">
              {% csrf_token %}
              <div class="relative">
                <select id="nota" name="nota" class="floating peer w-full" required>
                  {% for n in '12345' %}
                  <option value="{{ n }}">{{ n }}</option>
                  {% endfor %}
                </select>
                <label for="nota" class="label-float">{% trans "Nota" %}</label>
              </div>
              <div class="relative">
                <textarea id="comentario" name="comentario" rows="4" placeholder=" " class="floating peer w-full"></textarea>
                <label for="comentario" class="label-float">{% trans "Comentário" %}</label>
              </div>
              <div class="text-right">
                <button type="submit" class="btn btn-primary" aria-label="{% trans 'Enviar avaliação' %}">{% trans 'Enviar avaliação' %}</button>
              </div>
            </form>
          {% else %}
            <form method="post" action="{% url 'eventos:evento_subscribe' object.pk %}">
              {% csrf_token %}
              <button type="submit" class="btn btn-secondary" aria-label="{% trans 'Cancelar inscrição' %}">{% trans 'Cancelar inscrição' %}</button>
            </form>
          {% endif %}
        {% else %}
          <a href="{% url 'eventos:inscricao_criar' object.pk %}" class="btn btn-primary" aria-label="{% trans 'Inscrever-se' %}">{% trans 'Inscrever-se' %}</a>
        {% endif %}
      </div>
    </article>
    {% endif %}

    <article class="card">
      <div class="card-header">
        <h2 class="text-lg font-semibold">{% trans "Inscritos" %}</h2>
      </div>
      <div class="card-body">
        {% if object.inscricoes.all %}
          <div class="flex flex-col gap-4">
            {% for ins in object.inscricoes.all %}
              {% with inscrito=ins.user %}
                <article class="card">
                  <div class="card-body flex items-center gap-4">
                    {% if inscrito.avatar %}
                      <img src="{{ inscrito.avatar.url }}" alt="{{ inscrito.display_name|default:inscrito.username }}" class="w-12 h-12 rounded-full object-cover" loading="lazy">
                    {% else %}
                      <div class="w-12 h-12 rounded-full bg-[var(--bg-tertiary)] flex items-center justify-center text-sm font-semibold" role="img" aria-label="{{ inscrito.display_name|default:inscrito.username }}">
                        {{ inscrito.username|make_list|first|upper }}
                      </div>
                    {% endif %}
                    <div>
                      <h4 class="text-sm font-medium">{{ inscrito.display_name }}</h4>
                      <p class="text-xs">@{{ inscrito.username }}</p>
                    </div>
                  </div>
                </article>
              {% endwith %}
            {% endfor %}
          </div>
        {% else %}
          <p class="text-sm">{% trans "Nenhum inscrito." %}</p>
        {% endif %}
      </div>
    </article>
  </div>

  <div class="flex justify-end mt-6">
    {% url 'eventos:calendario' as back_href %}
    {% include '_components/back_button.html' with href=back_href %}
  </div>
</section>
