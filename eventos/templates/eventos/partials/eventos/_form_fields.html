{% load i18n widget_tweaks %}
<div class="space-y-6">
  <div class="grid gap-6 md:grid-cols-3">
    <div>
      {% include '_forms/field.html' with field=form.data_inicio %}
    </div>
    <div>
      {% include '_forms/field.html' with field=form.data_fim %}
    </div>
    <div>
      {% include '_forms/field.html' with field=form.status %}
    </div>
  </div>

  <div class="grid gap-6 md:grid-cols-3">
    <div>
      {% include '_forms/field.html' with field=form.publico_alvo %}
    </div>
    <div>
      {% include '_forms/field.html' with field=form.participantes_maximo %}
    </div>
    <div id="nucleo-field-container">
      {% include '_forms/field.html' with field=form.nucleo %}
    </div>
  </div>

  <div class="grid gap-6 md:grid-cols-2">
    <div id="valor-field-container" {% if form.gratuito.value %}class="hidden"{% endif %}>
      {% include '_forms/field.html' with field=form.valor %}
    </div>
    <div>
      {% include '_forms/field.html' with field=form.gratuito %}
    </div>
  </div>

  <div>
    {% include '_forms/field.html' with field=form.titulo %}
  </div>

  <div>
    {% include '_forms/field.html' with field=form.descricao %}
  </div>

  {% with cronograma_has_errors=form.cronograma.errors %}
  <div class="rounded-lg border border-[var(--border)] bg-[var(--bg-secondary)]" data-accordion>
    <button
      type="button"
      class="flex w-full items-center justify-between gap-3 px-4 py-3 text-left"
      data-accordion-toggle
      aria-expanded="{{ cronograma_has_errors|yesno:'true,false' }}"
      aria-controls="evento-cronograma-panel"
    >
      <span class="text-sm font-medium text-[var(--text-primary)]">{{ form.cronograma.label }}</span>
      <svg
        class="h-5 w-5 text-[var(--text-secondary)] transition-transform duration-200"
        data-accordion-icon
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        aria-hidden="true"
      >
        <polyline points="6 9 12 15 18 9"></polyline>
      </svg>
    </button>
    <div
      id="evento-cronograma-panel"
      class="border-t border-[var(--border)] px-4 py-4 {% if not cronograma_has_errors %}hidden{% endif %}"
      data-accordion-panel
    >
      {% include '_forms/field.html' with field=form.cronograma hide_label=True %}
    </div>
  </div>
  {% endwith %}

  <div class="rounded-lg border border-[var(--border)] bg-[var(--bg-secondary)]" data-accordion>
    <button
      type="button"
      class="flex w-full items-center justify-between gap-3 px-4 py-3 text-left"
      data-accordion-toggle
      aria-expanded="{% if form.local.errors or form.cidade.errors or form.estado.errors or form.cep.errors %}true{% else %}false{% endif %}"
      aria-controls="evento-localizacao-panel"
    >
      <span class="text-sm font-medium text-[var(--text-primary)]">{% trans "Localização" %}</span>
      <svg
        class="h-5 w-5 text-[var(--text-secondary)] transition-transform duration-200"
        data-accordion-icon
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        aria-hidden="true"
      >
        <polyline points="6 9 12 15 18 9"></polyline>
      </svg>
    </button>
    <div
      id="evento-localizacao-panel"
      class="border-t border-[var(--border)] px-4 py-4 {% if not form.local.errors and not form.cidade.errors and not form.estado.errors and not form.cep.errors %}hidden{% endif %}"
      data-accordion-panel
    >
      <div class="space-y-6">
        <div>
          {% include '_forms/field.html' with field=form.local %}
        </div>
        <div class="grid gap-6 md:grid-cols-3">
          <div>
            {% include '_forms/field.html' with field=form.cidade %}
          </div>
          <div>
            {% include '_forms/field.html' with field=form.estado %}
          </div>
          <div>
            {% include '_forms/field.html' with field=form.cep %}
          </div>
        </div>
      </div>
    </div>
  </div>

  {% with briefing_parcerias_errors=form.briefing.errors or form.parcerias.errors %}
  <div class="rounded-lg border border-[var(--border)] bg-[var(--bg-secondary)]" data-accordion>
    <button
      type="button"
      class="flex w-full items-center justify-between gap-3 px-4 py-3 text-left"
      data-accordion-toggle
      aria-expanded="{{ briefing_parcerias_errors|yesno:'true,false' }}"
      aria-controls="evento-briefing-parcerias-panel"
    >
      <span class="text-sm font-medium text-[var(--text-primary)]">{% trans "Briefing e parcerias" %}</span>
      <svg
        class="h-5 w-5 text-[var(--text-secondary)] transition-transform duration-200"
        data-accordion-icon
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        aria-hidden="true"
      >
        <polyline points="6 9 12 15 18 9"></polyline>
      </svg>
    </button>
    <div
      id="evento-briefing-parcerias-panel"
      class="border-t border-[var(--border)] px-4 py-4 {% if not briefing_parcerias_errors %}hidden{% endif %}"
      data-accordion-panel
    >
      <div class="grid gap-6 md:grid-cols-2">
        <div>
          {% include '_forms/field.html' with field=form.briefing %}
        </div>
        <div>
          {% include '_forms/field.html' with field=form.parcerias %}
        </div>
      </div>
    </div>
  </div>
  {% endwith %}

  {% with info_has_errors=form.informacoes_adicionais.errors %}
  <div class="rounded-lg border border-[var(--border)] bg-[var(--bg-secondary)]" data-accordion>
    <button
      type="button"
      class="flex w-full items-center justify-between gap-3 px-4 py-3 text-left"
      data-accordion-toggle
      aria-expanded="{{ info_has_errors|yesno:'true,false' }}"
      aria-controls="evento-informacoes-panel"
    >
      <span class="text-sm font-medium text-[var(--text-primary)]">{{ form.informacoes_adicionais.label }}</span>
      <svg
        class="h-5 w-5 text-[var(--text-secondary)] transition-transform duration-200"
        data-accordion-icon
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        aria-hidden="true"
      >
        <polyline points="6 9 12 15 18 9"></polyline>
      </svg>
    </button>
    <div
      id="evento-informacoes-panel"
      class="border-t border-[var(--border)] px-4 py-4 {% if not info_has_errors %}hidden{% endif %}"
      data-accordion-panel
    >
      {% include '_forms/field.html' with field=form.informacoes_adicionais hide_label=True %}
    </div>
  </div>
  {% endwith %}

  {% with media_errors=form.avatar.errors or form.cover.errors %}
  <div class="rounded-lg border border-[var(--border)] bg-[var(--bg-secondary)]" data-accordion>
    <button
      type="button"
      class="flex w-full items-center justify-between gap-3 px-4 py-3 text-left"
      data-accordion-toggle
      aria-expanded="{{ media_errors|yesno:'true,false' }}"
      aria-controls="evento-media-panel"
    >
      <span class="text-sm font-medium text-[var(--text-primary)]">{% trans "Mídias" %}</span>
      <svg
        class="h-5 w-5 text-[var(--text-secondary)] transition-transform duration-200"
        data-accordion-icon
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        aria-hidden="true"
      >
        <polyline points="6 9 12 15 18 9"></polyline>
      </svg>
    </button>
    <div
      id="evento-media-panel"
      class="border-t border-[var(--border)] px-4 py-4 {% if not media_errors %}hidden{% endif %}"
      data-accordion-panel
    >
      <div class="space-y-6">
        <div>
          {% include '_forms/field.html' with field=form.avatar %}
        </div>
        <div>
          {% include '_forms/field.html' with field=form.cover %}
        </div>
      </div>
    </div>
  </div>
  {% endwith %}
</div>
<script>
  (function () {
    const gratuitoField = document.querySelector('#id_gratuito');
    const valorContainer = document.querySelector('#valor-field-container');

    const toggleValor = () => {
      if (!valorContainer) {
        return;
      }
      if (gratuitoField && gratuitoField.checked) {
        valorContainer.classList.add('hidden');
      } else {
        valorContainer.classList.remove('hidden');
      }
    };

    if (gratuitoField) {
      gratuitoField.addEventListener('change', toggleValor);
    }
    toggleValor();

    const accordions = document.querySelectorAll('[data-accordion]');
    accordions.forEach((accordion) => {
      const toggle = accordion.querySelector('[data-accordion-toggle]');
      const panel = accordion.querySelector('[data-accordion-panel]');
      const icon = accordion.querySelector('[data-accordion-icon]');
      if (!(toggle instanceof HTMLElement) || !(panel instanceof HTMLElement)) {
        return;
      }

      const setExpanded = (expanded) => {
        toggle.setAttribute('aria-expanded', String(expanded));
        panel.classList.toggle('hidden', !expanded);
        if (icon instanceof HTMLElement) {
          icon.classList.toggle('rotate-180', expanded);
        }
      };

      const initialExpanded = toggle.getAttribute('aria-expanded') === 'true';
      setExpanded(initialExpanded);

      toggle.addEventListener('click', () => {
        const expanded = toggle.getAttribute('aria-expanded') === 'true';
        setExpanded(!expanded);
      });
    });

    const setupFileInput = (input) => {
      if (!(input instanceof HTMLInputElement)) {
        return;
      }
      if (input.dataset.customFileBound === 'true') {
        return;
      }

      const wrapper = input.closest('[data-profile-file], [data-file-upload]');
      const status = wrapper
        ? wrapper.querySelector('[data-profile-file-name], [data-file-upload-name]')
        : null;
      const clearControl = wrapper
        ? wrapper.querySelector('[data-profile-file-clear], [data-file-upload-clear]')
        : null;
      const emptyText = input.dataset.emptyText || (status && status.dataset.emptyText) || '';

      if (status instanceof HTMLElement) {
        status.dataset.emptyText = status.dataset.emptyText || emptyText;
        status.dataset.originalText = status.dataset.originalText || status.textContent || '';
      }

      const updateStatus = () => {
        if (!(status instanceof HTMLElement)) {
          return;
        }
        const files = input.files;
        if (files && files.length) {
          const names = Array.from(files)
            .map((file) => (file && file.name ? file.name : ''))
            .filter(Boolean);
          status.textContent = names.length ? names.join(', ') : emptyText;
          return;
        }

        if (clearControl instanceof HTMLInputElement && clearControl.checked) {
          status.textContent = emptyText;
          return;
        }

        const originalText = status.dataset.originalText || '';
        status.textContent = originalText || emptyText;
      };

      updateStatus();

      input.addEventListener('change', () => {
        if (clearControl instanceof HTMLInputElement && input.files && input.files.length) {
          clearControl.checked = false;
        }
        updateStatus();
      });

      if (clearControl instanceof HTMLInputElement) {
        clearControl.addEventListener('change', () => {
          if (clearControl.checked) {
            input.value = '';
            const event = new Event('change');
            input.dispatchEvent(event);
            if (status instanceof HTMLElement) {
              status.textContent = emptyText;
            }
          } else if (status instanceof HTMLElement) {
            const originalText = status.dataset.originalText || '';
            status.textContent = originalText || emptyText;
          }
        });
      }

      input.dataset.customFileBound = 'true';
    };

    const fileInputs = document.querySelectorAll('[data-profile-file-input], [data-file-upload-input]');
    fileInputs.forEach((input) => setupFileInput(input));
  })();
</script>
