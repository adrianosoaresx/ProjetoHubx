{% load i18n widget_tweaks %}
{% include "eventos/partials/_painel_hero_oob.html" with painel_hero_template='_components/hero_eventos_detail.html' evento=object %}
<section class="max-w-screen-xl mx-auto pt-8 px-6 lg:px-8">
  <h1 class="text-2xl font-bold text-[var(--text-primary)] mb-6">{% trans "Editar Evento" %}</h1>

  <form method="post" enctype="multipart/form-data" class="bg-[var(--bg-secondary)] border border-[var(--border)] rounded-2xl card-sm p-6 space-y-6">
    {% csrf_token %}
    {% for field in form %}
      {% if field.name != 'inscricoes' and field.name != 'numero_presentes' %}
        {% if field.name == 'avatar' or field.name == 'cover' %}
          {% if field.value %}
            <img src="{{ field.value.url }}" alt="{{ field.label }}" class="w-32 h-32 object-cover mb-2" loading="lazy">
          {% endif %}
          {% include '_forms/field.html' with field=field|attr:'accept:image/*' %}
        {% else %}
          {% include '_forms/field.html' with field=field %}
        {% endif %}
      {% endif %}
    {% endfor %}

    <div class="flex justify-end gap-3 pt-4 border-t border-[var(--border)]">
      <a href="{% url 'eventos:calendario' %}" class="btn btn-secondary" aria-label="{% trans 'Voltar' %}">{% trans "Voltar" %}</a>
      <button type="submit" class="btn btn-primary" aria-label="{% trans 'Salvar' %}">{% trans "Salvar" %}</button>
    </div>
  </form>

</section>

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const publicoAlvoSelect = document.getElementById('id_publico_alvo');
    const nucleoInput = document.getElementById('id_nucleo');
    const nucleoFieldWrapper = nucleoInput ? nucleoInput.closest('.space-y-1') : null;

    const toggleNucleoField = () => {
      if (!publicoAlvoSelect || !nucleoInput || !nucleoFieldWrapper) {
        return;
      }

      if (publicoAlvoSelect.value === '1') {
        nucleoFieldWrapper.classList.remove('hidden');
      } else {
        nucleoFieldWrapper.classList.add('hidden');
        nucleoInput.value = '';
      }
    };

    toggleNucleoField();

    if (publicoAlvoSelect) {
      publicoAlvoSelect.addEventListener('change', toggleNucleoField);
    }
  });
</script>
{% endblock %}
