{% extends 'base.html' %}
{% load i18n static %}

{% block hero %}
  <div id="painel-hero">
    {% with painel_title_default=_('Eventos') %}
      {% with hero_template=painel_hero_template|default:'_components/hero_evento.html' %}
        {% include hero_template with title=painel_title|default:painel_title_default subtitle=painel_subtitle action_template=painel_action_template breadcrumb_template=painel_breadcrumb_template neural_background=painel_neural_background style=painel_hero_style %}
      {% endwith %}
    {% endwith %}
  </div>
{% endblock %}

{% block content %}
<section class="mx-auto max-w-6xl px-4 lg:px-6 py-6">
  <div id="eventos-conteudo">
    {% if partial_template %}
      {% include partial_template %}
    {% elif dias_com_eventos is not None %}
      {% include 'eventos/partials/calendario/calendario.html' %}
    {% endif %}
  </div>
  <div id="eventos-loading" class="htmx-indicator mt-6 text-center text-sm text-[var(--text-secondary)]" role="status" aria-live="polite">
    {% trans 'Carregando eventos...' %}
  </div>
</section>
{% endblock %}

{% block scripts %}
  {{ block.super }}
  <script>
    (function() {
      const stateId = 'eventos-filter-state';

      function parseClasses(value) {
        return value ? value.split(/\s+/).filter(Boolean) : [];
      }

      function updateFilterButtons() {
        const stateEl = document.getElementById(stateId);
        if (!stateEl) {
          return;
        }
        const currentFilter = stateEl.dataset.currentFilter || 'todos';
        const buttons = document.querySelectorAll('[data-eventos-filter-card]');

        buttons.forEach((button) => {
          const activeClasses = parseClasses(button.dataset.activeClass || '');
          const isActive = button.dataset.eventosFilterCard === currentFilter;
          button.setAttribute('aria-pressed', isActive ? 'true' : 'false');
          activeClasses.forEach((cls) => {
            if (cls) {
              button.classList.toggle(cls, isActive);
            }
          });
        });
      }

      document.addEventListener('DOMContentLoaded', updateFilterButtons);
      document.body.addEventListener('htmx:afterSwap', function(event) {
        if (event.target && event.target.id === 'eventos-conteudo') {
          updateFilterButtons();
        }
      });
      document.body.addEventListener('htmx:oobAfterSwap', function(event) {
        const target = event.detail && event.detail.target;
        if (target && target.id === stateId) {
          updateFilterButtons();
        }
      });
    })();
  </script>
{% endblock %}
