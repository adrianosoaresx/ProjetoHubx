{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "Resultado da inscrição" %}{% endblock %}

{% block content %}
  <section class="mx-auto max-w-4xl space-y-6 px-4 py-8">
    <article class="card">
      <div class="card-header flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
        <div>
          <p class="text-sm text-[var(--text-secondary)]">
            {% if status == 'error' %}
              {% trans "Inscrição não concluída" %}
            {% elif status == 'info' %}
              {% trans "Inscrição em andamento" %}
            {% else %}
              {% trans "Inscrição confirmada" %}
            {% endif %}
          </p>
          <h1 class="text-2xl font-semibold text-[var(--text-primary)]">{{ evento.titulo }}</h1>
          <p class="text-sm text-[var(--text-secondary)]">{{ evento.organizacao|default:_('Evento') }}</p>
        </div>
        <div class="flex flex-col items-end gap-2 md:flex-row md:items-center">
          <div class="flex gap-2">
            <a href="{{ evento.get_absolute_url }}" class="btn btn-ghost text-sm">{% trans "Ver evento" %}</a>
          </div>
        </div>
      </div>

      {% if convite and convite.imagem or evento.cover %}
        <div class="px-6">
          <div class="mt-4 h-56 w-full overflow-hidden rounded-xl border border-[var(--border)] md:h-64">
            {% if convite and convite.imagem %}
              <img
                src="{{ convite.imagem.url }}"
                alt="{% blocktrans with titulo=evento.titulo %}Imagem do convite para {{ titulo }}{% endblocktrans %}"
                class="h-full w-full object-cover"
                loading="lazy"
              />
            {% elif evento.cover %}
              <img
                src="{{ evento.cover.url }}"
                alt="{% blocktrans with titulo=evento.titulo %}Imagem de capa do evento {{ titulo }}{% endblocktrans %}"
                class="h-full w-full object-cover"
                loading="lazy"
              />
            {% endif %}
          </div>
        </div>
      {% endif %}

      <div class="card-body space-y-4">
        {% if convite %}
          <div class="grid gap-4 md:grid-cols-2">
            <div class="space-y-2">
              <h2 class="text-lg font-semibold text-[var(--text-primary)]">{% trans "Informações" %}</h2>
              <p class="text-sm text-[var(--text-secondary)]">{{ convite.publico_alvo|default:evento.get_publico_alvo_display }}</p>
              <p class="text-sm text-[var(--text-secondary)]">
                {% with inicio=convite.data_inicio|default:evento.data_inicio fim=convite.data_fim|default:evento.data_fim %}
                  {% blocktrans with inicio=inicio|date:"d/m/Y" fim=fim|date:"d/m/Y" %}
                    De {{ inicio }} até {{ fim }}
                  {% endblocktrans %}
                {% endwith %}
              </p>
              <p class="text-sm text-[var(--text-secondary)]">{{ convite.local|default:evento.local }}</p>
              {% with cidade=convite.cidade|default:evento.cidade estado=convite.estado|default:evento.estado %}
                <p class="text-sm text-[var(--text-secondary)]">{{ cidade }}{% if cidade and estado %} - {% endif %}{{ estado }}</p>
              {% endwith %}
              {% if convite.numero_participantes %}
                <p class="text-sm text-[var(--text-secondary)]">
                  {% blocktrans with total=convite.numero_participantes %}Até {{ total }} participantes{% endblocktrans %}
                </p>
              {% endif %}
            </div>
            <div class="space-y-3">
              {% if convite.cronograma %}
                <div class="space-y-1">
                  <h3 class="text-base font-semibold text-[var(--text-primary)]">{% trans "Cronograma" %}</h3>
                  <p class="whitespace-pre-line text-sm text-[var(--text-secondary)]">{{ convite.cronograma }}</p>
                </div>
              {% endif %}
              {% if convite.informacoes_adicionais %}
                <div class="space-y-1">
                  <h3 class="text-base font-semibold text-[var(--text-primary)]">{% trans "Informações adicionais" %}</h3>
                  <p class="whitespace-pre-line text-sm text-[var(--text-secondary)]">{{ convite.informacoes_adicionais }}</p>
                </div>
              {% endif %}
            </div>
          </div>
        {% else %}
          <div class="grid gap-3 rounded-lg bg-[var(--bg-muted)] px-4 py-3 md:grid-cols-3">
            <div class="space-y-1">
              <p class="text-xs font-medium uppercase tracking-wide text-[var(--text-secondary)]">{% trans "Público-alvo" %}</p>
              <p class="text-sm text-[var(--text-primary)]">{{ evento.get_publico_alvo_display }}</p>
            </div>
            <div class="space-y-1">
              <p class="text-xs font-medium uppercase tracking-wide text-[var(--text-secondary)]">{% trans "Datas" %}</p>
              <p class="text-sm text-[var(--text-primary)]">
                {% blocktrans with inicio=evento.data_inicio|date:"d/m/Y H:i" fim=evento.data_fim|date:"d/m/Y H:i" %}
                  De {{ inicio }} até {{ fim }}
                {% endblocktrans %}
              </p>
            </div>
            <div class="space-y-1">
              <p class="text-xs font-medium uppercase tracking-wide text-[var(--text-secondary)]">{% trans "Local" %}</p>
              <p class="text-sm text-[var(--text-primary)]">{{ evento.local }}</p>
              <p class="text-xs text-[var(--text-secondary)]">{{ evento.cidade }}{% if evento.cidade and evento.estado %} - {% endif %}{{ evento.estado }}</p>
            </div>
          </div>
        {% endif %}

        {% if status == 'error' %}
          <div class="space-y-3 rounded-lg border border-[var(--error)] bg-[var(--error)]/10 px-4 py-3">
            <div class="flex items-center gap-2 text-[var(--error)]">
              <span class="h-2 w-2 rounded-full bg-[var(--error)]"></span>
              <p class="text-sm font-semibold">{% trans "Não foi possível concluir sua inscrição" %}</p>
            </div>
            <p class="text-sm text-[var(--text-primary)]">{{ message|default:_('O evento pode estar com vagas esgotadas ou ocorreu um erro ao processar a inscrição.') }}</p>
            <div class="flex flex-col gap-2 md:flex-row md:items-center">
              <a href="{{ inscricao_url }}" class="btn btn-primary md:w-auto">{% trans "Tentar novamente" %}</a>
              <a href="{{ share_url|default:evento.get_absolute_url }}" class="btn btn-secondary md:w-auto">{% trans "Voltar ao evento" %}</a>
            </div>
          </div>
        {% else %}
          <div class="space-y-2">
            <p class="text-sm font-medium text-[var(--text-primary)]">{{ message|default:_('Sua inscrição foi registrada. Confira abaixo os próximos passos.') }}</p>
            <p class="text-sm text-[var(--text-secondary)]">{% trans "Guarde estas informações para facilitar seu check-in." %}</p>
          </div>

          <div class="grid gap-4 md:grid-cols-2">
            <div class="space-y-3 rounded-lg border border-[var(--border)] px-4 py-3">
              <p class="text-sm font-semibold text-[var(--text-primary)]">{% trans "Detalhes da inscrição" %}</p>
              <dl class="space-y-2 text-sm text-[var(--text-secondary)]">
                <div class="flex justify-between">
                  <dt>{% trans "Status" %}</dt>
                  <dd class="font-medium text-[var(--text-primary)]">{{ inscricao.get_status_display }}</dd>
                </div>
                <div class="flex justify-between">
                  <dt>{% trans "Participante" %}</dt>
                  <dd class="font-medium text-[var(--text-primary)]">{{ inscricao.user.get_full_name|default:inscricao.user.username }}</dd>
                </div>
                {% if inscricao.valor_pago %}
                  <div class="flex justify-between">
                    <dt>{% trans "Valor" %}</dt>
                    <dd class="font-medium text-[var(--text-primary)]">{{ inscricao.valor_pago }}</dd>
                  </div>
                {% endif %}
              </dl>
            </div>

            {% if inscricao.qrcode_url %}
              <div class="space-y-3 rounded-lg border border-[var(--border)] px-4 py-3">
                <p class="text-sm font-semibold text-[var(--text-primary)]">{% trans "QR Code de acesso" %}</p>
                <div class="flex flex-col items-center gap-3">
                  <img
                    src="{{ inscricao.qrcode_url }}"
                    alt="{% blocktrans with titulo=evento.titulo %}QR Code do evento {{ titulo }}{% endblocktrans %}"
                    class="h-40 w-40 rounded-lg border border-[var(--border)] bg-white p-2"
                    loading="lazy"
                  />
                  <a
                    href="{{ inscricao.qrcode_url }}"
                    class="btn btn-primary w-full md:w-auto"
                    download
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    {% trans "Salvar/Compartilhar" %}
                  </a>
                </div>
              </div>
            {% endif %}
          </div>

          <div class="space-y-2 rounded-lg bg-[var(--bg-muted)] px-4 py-3">
            <p class="text-sm font-medium text-[var(--text-primary)]">{% trans "Próximos passos" %}</p>
            <ul class="list-disc space-y-1 pl-5 text-sm text-[var(--text-secondary)]">
              <li>{% trans "Confirme o e-mail enviado para finalizar qualquer etapa pendente." %}</li>
              <li>{% trans "Revise o horário e local na agenda para planejar sua chegada." %}</li>
              <li>{% trans "Apresente o QR Code ou documento com foto no dia do evento." %}</li>
            </ul>
          </div>
        {% endif %}
      </div>

      <div class="flex flex-col gap-3 border-t border-[var(--border)] px-6 py-4 md:flex-row md:items-center md:justify-end">
        {% if status == 'error' %}
          <a href="{{ inscricao_url }}" class="btn btn-primary">{% trans "Tentar novamente" %}</a>
          <a href="{{ share_url|default:evento.get_absolute_url }}" class="btn btn-secondary">{% trans "Voltar ao evento" %}</a>
        {% else %}
          <a href="{{ share_url|default:evento.get_absolute_url }}" class="btn btn-secondary">{% trans "Ver detalhes do evento" %}</a>
        {% endif %}
      </div>
    </article>
  </section>
{% endblock %}

{% block scripts %}
  {{ block.super }}
{% endblock %}
