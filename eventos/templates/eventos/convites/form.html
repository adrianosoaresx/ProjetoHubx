{% extends 'base.html' %}
{% load i18n %}

{% block title %}{{ title|default:_('Novo convite') }}{% endblock %}

{% block hero %}
  {% include "components/hero_evento_detail.html" with evento=evento %}
{% endblock %}

{% block content %}
  <article class="card">
    <div class="card-header flex items-center justify-between gap-4">
      <div>
        <p class="text-sm text-[var(--text-secondary)]">{% trans "Convite" %}</p>
        <h2 class="text-xl font-semibold text-[var(--text-primary)]">{{ title|default:_('Novo convite') }}</h2>
        <p class="text-sm text-[var(--text-secondary)]">{{ subtitle }}</p>
      </div>
      <a href="{{ back_href }}" class="btn btn-link text-[var(--text-primary)]">{% trans "Voltar" %}</a>
    </div>
    <div class="card-body space-y-6">
      <form method="post" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}
        {{ form.non_field_errors }}
        <div class="grid gap-6 md:grid-cols-2">
          {% include '_forms/field.html' with field=form.publico_alvo %}
          {% include '_forms/field.html' with field=form.numero_participantes %}
        </div>
        <div class="grid gap-6 md:grid-cols-2">
          {% include '_forms/field.html' with field=form.data_inicio %}
          {% include '_forms/field.html' with field=form.data_fim %}
        </div>
        <div class="grid gap-6 md:grid-cols-3">
          {% include '_forms/field.html' with field=form.local %}
          {% include '_forms/field.html' with field=form.cidade %}
          {% include '_forms/field.html' with field=form.estado %}
        </div>
        {% include '_forms/field.html' with field=form.cronograma %}
        {% include '_forms/field.html' with field=form.informacoes_adicionais %}
        <div class="space-y-2">
          {% include '_forms/field.html' with field=form.imagem %}
          <div class="flex items-center gap-4" id="convite-image-preview" aria-live="polite">
            {% if evento.cover %}
              <img src="{{ evento.cover.url }}" alt="{% trans 'Pré-visualização do convite' %}" class="h-24 w-24 rounded-lg object-cover border border-[var(--border)]" />
            {% else %}
              <img src="" alt="{% trans 'Pré-visualização do convite' %}" class="hidden h-24 w-24 rounded-lg object-cover border border-[var(--border)]" />
            {% endif %}
            <p class="text-sm text-[var(--text-secondary)]">{% trans "Selecione uma imagem para visualizar aqui." %}</p>
          </div>
        </div>
        <div class="flex justify-end gap-3 pt-4 border-t border-[var(--border)]">
          <a href="{% url 'eventos:evento_detalhe' evento.pk %}" class="btn btn-secondary">{% trans "Cancelar" %}</a>
          <button type="submit" class="btn btn-primary" aria-label="{% trans 'Salvar convite' %}">{% trans "Salvar" %}</button>
        </div>
      </form>
    </div>
  </article>
{% endblock %}

{% block scripts %}
  {{ block.super }}
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const input = document.querySelector('[data-convite-image-input]');
      const previewContainer = document.getElementById('convite-image-preview');
      const previewImage = previewContainer ? previewContainer.querySelector('img') : null;

      if (!input || !previewContainer || !previewImage) return;

      input.addEventListener('change', (event) => {
        const [file] = event.target.files || [];
        if (!file) {
          previewImage.classList.add('hidden');
          previewImage.removeAttribute('src');
          return;
        }

        const reader = new FileReader();
        reader.onload = (e) => {
          previewImage.src = e.target.result;
          previewImage.classList.remove('hidden');
        };
        reader.readAsDataURL(file);
      });
    });
  </script>
{% endblock %}
