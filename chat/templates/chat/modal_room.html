{% load i18n static %}
<aside
  id="room-modal"
  class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"
  role="dialog"
  aria-modal="true"
  hx-target="this"
  hx-swap="outerHTML"
>
  <section
    id="chat-container"
    class="relative bg-white rounded-lg max-w-lg w-full p-6 space-y-4"
    tabindex="-1"
    data-dest-id="{{ messages.0.channel.id }}"
    data-current-user="{{ request.user.username }}"
    data-csrf-token="{{ csrf_token }}"
  >
    <button
      type="button"
      class="absolute top-2 right-2 text-neutral-500 hover:text-neutral-700"
      onclick="fecharChat()"
      aria-label="{% trans 'Fechar' %}"
    >âœ•</button>
    <h2 class="text-lg font-semibold">{{ dest.get_full_name|default:dest.username }}</h2>
    <ul class="space-y-2 max-h-96 overflow-y-auto" id="chat-messages">
      {% for m in messages %}
        <li class="border-b border-neutral-200 pb-2">
          <strong>{{ m.remetente.username }}:</strong>
          {% if m.tipo == "text" %}{{ m.conteudo }}{% else %}
            <a href="{{ m.conteudo }}">{{ m.tipo }}</a>
          {% endif %}
        </li>
      {% empty %}
        <li class="text-neutral-500">{% trans "Nenhuma mensagem." %}</li>
      {% endfor %}
    </ul>
    <div id="reply-preview" class="hidden text-sm text-neutral-700"></div>
    <form id="chat-form" class="mt-2 flex items-center gap-2" aria-label="{% trans 'Enviar mensagem' %}">
      {% csrf_token %}
      <input
        type="text"
        id="chat-input"
        class="flex-1 border rounded p-2"
        placeholder="{% trans 'Mensagem' %}"
      />
      <input type="file" id="file-input" class="hidden" />
      <button
        type="button"
        id="upload-btn"
        class="p-2 border rounded"
        aria-label="{% trans 'Enviar arquivo' %}"
      >ðŸ“Ž</button>
      <button
        type="submit"
        class="bg-primary text-white px-4 py-2 rounded"
        aria-label="{% trans 'Enviar mensagem' %}"
      >{% trans 'Enviar' %}</button>
    </form>
    <script>
      (function () {
        function init() {
          if (window.HubXChatRoom) {
            HubXChatRoom.init(document.getElementById('chat-container'));
          }
        }
        if (!window.HubXChatRoom) {
          var s = document.createElement('script');
          s.src = '{% static 'chat/js/chat_socket.js' %}';
          s.onload = init;
          document.head.appendChild(s);
        } else {
          init();
        }
      })();
    </script>
  </section>
</aside>
