{% extends "chat/base_chat.html" %}
{% load i18n %}

{% block chat_content %}
<h2 class="text-xl font-semibold mb-2">{% trans "Histórico de edições" %}</h2>
<p class="mb-4 text-sm text-gray-700">{{ message.conteudo|linebreaksbr }}</p>
<form method="get" class="mb-4 flex flex-wrap gap-2 items-end">
  <div>
    <label for="inicio" class="block text-sm">{% trans "Início" %}</label>
    <input type="date" name="inicio" id="inicio" value="{{ request.GET.inicio }}" class="border px-2 py-1 rounded" />
  </div>
  <div>
    <label for="fim" class="block text-sm">{% trans "Fim" %}</label>
    <input type="date" name="fim" id="fim" value="{{ request.GET.fim }}" class="border px-2 py-1 rounded" />
  </div>
  <button type="submit" class="px-3 py-1 bg-primary text-white rounded">{% trans "Filtrar" %}</button>
  <button type="submit" name="export" value="csv" class="px-3 py-1 border rounded">{% trans "Exportar CSV" %}</button>
</form>
<div class="overflow-x-auto">
  <table class="min-w-full text-sm">
    <thead>
      <tr class="text-left">
        <th class="px-2 py-1">{% trans "Data" %}</th>
        <th class="px-2 py-1">{% trans "Moderador" %}</th>
        <th class="px-2 py-1">{% trans "Conteúdo anterior" %}</th>
        <th class="px-2 py-1">{% trans "Ações" %}</th>
      </tr>
    </thead>
    <tbody>
      {% for log in logs %}
      <tr class="border-t">
        <td class="px-2 py-1"><time datetime="{{ log.created_at|date:'c' }}">{{ log.created_at|date:'d/m/Y H:i' }}</time></td>
        <td class="px-2 py-1">{{ log.moderator.username }}</td>
        <td class="px-2 py-1">{{ log.previous_content|linebreaksbr }}</td>
        <td class="px-2 py-1">
          <form method="post" hx-post="/api/chat/channels/{{ channel.id }}/messages/{{ message.id }}/restore/" hx-swap="none">
            {% csrf_token %}
            <input type="hidden" name="log_id" value="{{ log.id }}" />
            <button type="submit" class="px-2 py-1 text-xs bg-primary text-white rounded">{% trans "Restaurar" %}</button>
          </form>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="4" class="px-2 py-4 text-center text-neutral-500">{% trans "Nenhum registro" %}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% if logs.has_other_pages %}
<div class="mt-4 flex justify-between items-center text-sm">
  {% if logs.has_previous %}
    <a href="?page={{ logs.previous_page_number }}" class="text-blue-600 hover:underline">{% trans "Anterior" %}</a>
  {% else %}
    <span></span>
  {% endif %}
  <span>{{ logs.number }}/{{ logs.paginator.num_pages }}</span>
  {% if logs.has_next %}
    <a href="?page={{ logs.next_page_number }}" class="text-blue-600 hover:underline">{% trans "Próxima" %}</a>
  {% else %}
    <span></span>
  {% endif %}
</div>
{% endif %}
{% endblock %}
