{% load i18n %}
<div class="p-4 space-y-3" aria-live="polite">
  <div class="flex items-center justify-between gap-2">
    <p class="text-sm font-semibold text-[var(--text-primary)]">{% trans "Notificações recentes" %}</p>
    <a
      href="{% url 'notificacoes:notificacoes-list' %}"
      class="text-xs font-medium text-[var(--primary)] hover:text-[var(--primary-dark)] focus:outline-none focus:underline"
    >
      {% trans "Ver todas" %}
    </a>
  </div>
  {% if logs %}
    <ul class="divide-y divide-[var(--border)]" role="none">
      {% for log in logs %}
        <li
          class="py-3 flex gap-3"
          role="menuitem"
          tabindex="0"
          data-notification-item
          data-target-url="{{ log.target_url }}"
        >
          <span class="flex h-10 w-10 items-center justify-center rounded-full bg-[var(--bg-tertiary)] text-[var(--text-primary)]" aria-hidden="true">
            {% if log.canal == 'email' %}
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 8l9 6 9-6" />
                <rect width="18" height="12" x="3" y="6" rx="2" ry="2" />
              </svg>
            {% elif log.canal == 'whatsapp' %}
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 32 32" fill="currentColor">
                <path d="M16 .5C7.6.5.5 7.6.5 16c0 2.8.8 5.4 2.2 7.7L1 31l7.5-1.6c2.2 1.2 4.7 1.9 7.5 1.9 8.4 0 15.5-7.1 15.5-15.5C31.5 7.6 24.4.5 16 .5zm0 28.2c-2.4 0-4.7-.7-6.7-1.9l-.5-.3-4.4 1 1-4.3-.3-.5C3.8 20.3 3.1 18.2 3.1 16 3.1 9 9 3.1 16 3.1S28.9 9 28.9 16 23 28.7 16 28.7zm8.7-7.3c-.5-.3-2.6-1.3-3-1.4-.4-.1-.7-.3-1 .2-.3.5-1.2 1.4-1.4 1.7-.3.3-.5.3-1 0-.5-.3-2-1-3.7-2.9-1.4-1.6-1.8-2.8-2-3.3-.2-.5 0-.8.2-1.1.2-.2.5-.6.7-.8.2-.3.3-.5.5-.8.2-.3.1-.6 0-.8-.1-.2-1-2.4-1.4-3.3-.4-.9-.7-.8-1-.8h-.8c-.3 0-.8.1-1.2.5-.4.4-1.5 1.4-1.5 3.4 0 2 .8 3.9 1 4.1.1.3 1.6 3.1 4 4.8 2.7 2 4.9 2.6 5.6 2.9.7.3 1.3.2 1.8.1.5-.1 2.6-1 3-1.9.4-.9.4-1.7.3-1.9-.2-.2-.5-.3-1-.6z" />
              </svg>
            {% else %}
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M10 21a1 1 0 0 0 2 0" />
                <path d="M18 8a6 6 0 1 0-12 0c0 7-3 9-3 9h18s-3-2-3-9" />
              </svg>
            {% endif %}
          </span>
          <div class="flex-1 min-w-0 space-y-1">
            <a href="{{ log.target_url }}" class="block space-y-1 group focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] focus:ring-offset-2 focus:ring-offset-[var(--bg-primary)] rounded">
              <p class="text-sm font-semibold text-[var(--text-primary)] leading-tight group-hover:text-[var(--primary)]">{{ log.template.assunto }}</p>
              <p class="text-xs text-[var(--text-secondary)] leading-snug">{{ log.corpo_renderizado|default:log.template.corpo|striptags|truncatechars:140 }}</p>
              <p class="text-[11px] text-[var(--text-muted)]">{{ log.data_envio|default:log.created_at|date:"SHORT_DATETIME_FORMAT" }}</p>
            </a>
            <div class="flex flex-wrap gap-2 pt-1">
              <a
                href="{{ log.target_url }}"
                class="text-xs font-medium text-[var(--primary)] hover:text-[var(--primary-dark)] focus:outline-none focus:underline"
              >
                {% trans "Ver detalhes" %}
              </a>
              <button
                type="button"
                class="text-xs font-medium text-[var(--text-secondary)] hover:text-[var(--primary)] focus:outline-none"
                hx-ext="json-enc"
                hx-patch="{% url 'notificacoes_api:log-detail' log.id %}"
                hx-vals='{"status": "lida"}'
                hx-headers='{"X-CSRFToken": "{{ csrf_token }}", "Content-Type": "application/json"}'
                hx-on::after-request="if(event.detail.xhr.status===204){const item=this.closest('[data-notification-item]');item?.remove();window.HubxNotifications?.decrement();}"
              >
                {% trans "Marcar como lida" %}
              </button>
            </div>
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="py-6 text-center text-sm text-[var(--text-secondary)]" role="status">
      {% blocktrans %}Você está em dia: nenhuma nova notificação.{% endblocktrans %}
    </p>
  {% endif %}
</div>
