{% load i18n static %}
<aside
  id="sidebar"
  class="fixed inset-y-0 left-0 z-40 w-64 bg-[var(--bg-secondary)] border-r border-[var(--border)] flex flex-col transform -translate-x-full sidebar-transition md:translate-x-0 md:w-64"
  aria-hidden="true"
>
  <div class="sidebar-header layout-header flex items-center justify-between px-4 py-4 border-b border-[var(--border)]">
    <a href="/" class="text-2xl font-bold text-[var(--text-primary)] flex items-center gap-2" aria-label="{% trans 'PÃ¡gina inicial' %}" {% if request.path == '/' %}aria-current="page"{% endif %}>
      <img src="{% static 'img/hubx_logo.png' %}" alt="{% trans 'Logo Hubx.Space' %}" class="h-10 md:h-12 w-auto max-w-full" loading="lazy" />
      <span class="sidebar-brand-label">{% trans 'Hubx' %}</span>
    </a>
    <div class="flex items-center gap-2">
      <button
        type="button"
        id="mobile-sidebar-close"
        class="md:hidden btn btn-secondary btn-sm"
        aria-label="{% trans 'Fechar menu' %}"
        aria-controls="sidebar"
        aria-expanded="false"
      >
        <span class="sr-only">{% trans 'Fechar' %}</span>
        <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
      <button id="sidebar-toggle" class="hidden md:inline-flex btn btn-secondary btn-sm" aria-label="{% trans 'Alternar menu' %}" aria-controls="sidebar" aria-expanded="true">
        <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </div>
  <nav class="sidebar-nav flex-1 overflow-y-auto px-4 py-4" role="navigation" aria-label="{% trans 'Menu' %}">
    {% with request.resolver_match as resolver_match %}
    <ul class="sidebar-menu flex flex-col gap-1">
      {% for item in NAV_MENU %}
        <li class="sidebar-entry">
          {% if item.children %}
            <div class="sidebar-parent">
              {% if item.id == 'eventos' and resolver_match and resolver_match.app_name == 'eventos' %}
                {% url 'eventos:lista' as eventos_lista_partial_url %}
              {% endif %}
              <a href="{{ item.path }}" class="sidebar-item{% if item.is_active %} sidebar-item-active{% endif %}{% if item.classes %} {{ item.classes }}{% endif %}" {% if item.is_current %}aria-current="page"{% endif %}{% if item.target %} target="{{ item.target }}"{% if item.target == '_blank' %} rel="noopener noreferrer"{% endif %}{% endif %}>
                {% if item.id == 'perfil' and user.avatar %}
                  <img src="{{ user.avatar.url }}" alt="{{ user.username }}" class="w-6 h-6 rounded-full object-cover" loading="lazy" />
                {% else %}
                  {{ item.icon|safe }}
                {% endif %}
                <span class="sidebar-label">{{ item.label }}</span>
              </a>
              <button type="button" class="sidebar-toggle" aria-expanded="{{ item.is_active|yesno:'true,false' }}" aria-controls="submenu-{{ item.id }}" data-sidebar-submenu-toggle>
                <span class="sr-only">{% blocktrans with label=item.label %}Alternar {{ label }}{% endblocktrans %}</span>
                <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="sidebar-toggle-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="m6 9 6 6 6-6" />
                </svg>
              </button>
            </div>
            <ul id="submenu-{{ item.id }}" class="sidebar-submenu{% if not item.is_active %} hidden{% endif %}" data-sidebar-submenu>
              {% for child in item.children %}
                <li>
                  <a href="{{ child.path }}" class="sidebar-subitem{% if child.is_active %} sidebar-item-active{% endif %}" {% if child.is_current %}aria-current="page"{% endif %}{% if child.target %} target="{{ child.target }}"{% if child.target == '_blank' %} rel="noopener noreferrer"{% endif %}{% endif %}>
                    {{ child.icon|safe }}
                    <span class="sidebar-label">{{ child.label }}</span>
                  </a>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <a href="{{ item.path }}" class="sidebar-item{% if item.is_active %} sidebar-item-active{% endif %}{% if item.classes %} {{ item.classes }}{% endif %}" {% if item.is_current %}aria-current="page"{% endif %}{% if item.target %} target="{{ item.target }}"{% if item.target == '_blank' %} rel="noopener noreferrer"{% endif %}{% endif %}>
              {% if item.id == 'perfil' and user.avatar %}
                <img src="{{ user.avatar.url }}" alt="{{ user.username }}" class="w-6 h-6 rounded-full object-cover" loading="lazy" />
              {% else %}
                {{ item.icon|safe }}
              {% endif %}
              <span class="sidebar-label">{{ item.label }}</span>
            </a>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
    {% endwith %}
    <div class="mt-6 pt-4 border-t border-[var(--border)] space-y-3">
      <span class="text-xs font-semibold tracking-wide text-[var(--text-muted)] uppercase">{% trans "Tema" %}</span>
      <div class="flex items-center gap-2" role="group" aria-label="{% trans 'Tema' %}">
        <button type="button" class="btn btn-secondary flex-1 justify-center aria-pressed:bg-[var(--primary)] aria-pressed:text-[var(--text-inverse)] aria-pressed:border-[var(--primary)]" data-theme-option="claro" aria-pressed="false">
          <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="4" />
            <path d="M12 2v2m0 16v2m10-10h-2M4 12H2m15.364-7.364-1.414 1.414M6.05 17.95l-1.414 1.414m12.728 0-1.414-1.414M6.05 6.05 4.636 4.636" />
          </svg>
          <span class="sr-only">{% trans "Claro" %}</span>
        </button>
        <button type="button" class="btn btn-secondary flex-1 justify-center aria-pressed:bg-[var(--primary)] aria-pressed:text-[var(--text-inverse)] aria-pressed:border-[var(--primary)]" data-theme-option="escuro" aria-pressed="false">
          <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path d="M17.293 13.293A8 8 0 1 1 6.707 2.707a8.003 8.003 0 0 0 10.586 10.586z" />
          </svg>
          <span class="sr-only">{% trans "Escuro" %}</span>
        </button>
      </div>
    </div>
  </nav>
</aside>

