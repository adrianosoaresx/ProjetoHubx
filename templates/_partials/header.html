{% load i18n %}
<header class="layout-header bg-[var(--bg-secondary)] border-[var(--border)] px-4 py-4 flex items-center gap-4 justify-between fixed md:sticky inset-x-0 top-0 z-30 shadow-sm">
  <button
    type="button"
    id="mobile-sidebar-toggle"
    class="md:hidden inline-flex h-10 w-10 items-center justify-center rounded border border-[var(--border)] bg-[var(--bg-primary)] text-[var(--text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]"
    aria-label="{% trans 'Alternar menu' %}"
    aria-controls="sidebar"
    aria-expanded="false"
  >
    <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
    </svg>
  </button>
  <a href="/" class="text-base md:text-xl font-bold text-[var(--text-primary)] flex items-center gap-2 min-w-0" aria-label="{% trans 'Página inicial' %}">
    {% if request.user.is_authenticated and request.user.organizacao %}
      <span class="flex h-8 w-8 items-center justify-center overflow-hidden rounded-full bg-[var(--bg-tertiary)]">
        {% if request.user.organizacao.avatar %}
          <img src="{{ request.user.organizacao.avatar.url }}" alt="{{ request.user.organizacao.nome }}" class="h-full w-full object-cover" loading="lazy" />
        {% else %}
          <span class="text-sm font-semibold text-[var(--text-muted)]">
            {{ request.user.organizacao.nome|make_list|first|upper }}
          </span>
        {% endif %}
      </span>
      <span class="truncate max-w-[10rem] sm:max-w-[14rem] md:max-w-none" title="{{ request.user.organizacao.nome }}">{{ request.user.organizacao.nome }}</span>
    {% else %}
      {% trans 'Hubx.Space' %}
    {% endif %}
  </a>
  <form action="#" method="get" role="search" class="hidden sm:block flex-1 max-w-md">
    <label for="header-search"><span class="sr-only">{% trans 'Buscar' %}</span></label>
    <input id="header-search" name="q" type="search" placeholder="{% trans 'Buscar' %}" class="w-full border border-[var(--border)] bg-[var(--bg-primary)] rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)]" />
  </form>
  <div class="flex items-center gap-3 sm:gap-4 flex-nowrap">
    {% with pending_notifications=push_notification_pending_count|default:0 count_placeholder="__count__" %}
    {% blocktrans count notification_count=pending_notifications asvar notification_label %}Notificações pendentes: {{ notification_count }}{% plural %}Notificações pendentes: {{ notification_count }}{% endblocktrans %}
    {% blocktrans count notification_count=1 asvar notification_label_one %}Notificações pendentes: {{ count_placeholder }}{% plural %}Notificações pendentes: {{ count_placeholder }}{% endblocktrans %}
    {% blocktrans count notification_count=2 asvar notification_label_other %}Notificações pendentes: {{ count_placeholder }}{% plural %}Notificações pendentes: {{ count_placeholder }}{% endblocktrans %}
      <div class="relative shrink-0">
        <button
          type="button"
          id="notification-bell"
          class="relative inline-flex h-10 w-12 items-center justify-center gap-1 rounded text-[var(--text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)] focus:ring-offset-2 focus:ring-offset-[var(--bg-secondary)]"
          aria-label="{{ notification_label }}"
          aria-haspopup="true"
          aria-expanded="false"
          aria-controls="notification-dropdown"
          data-notification-bell
          data-dropdown-url="{% url 'notificacoes:notifications-dropdown' %}"
          data-notification-count="{{ pending_notifications }}"
          data-notification-label-one="{{ notification_label_one|escape }}"
          data-notification-label-other="{{ notification_label_other|escape }}"
          hx-get="{% url 'notificacoes:notifications-dropdown' %}"
          hx-target="#notification-dropdown"
          hx-swap="innerHTML"
          hx-trigger="click"
        >
          <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M10 21a1 1 0 0 0 2 0" />
            <path d="M18 8a6 6 0 1 0-12 0c0 7-3 9-3 9h18s-3-2-3-9" />
          </svg>
          {% include 'notificacoes/partials/push_notification_badge.html' with push_notification_pending_count=pending_notifications %}
          <span data-dropdown-indicator class="transition-transform duration-150" aria-hidden="true">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.94l3.71-3.71a.75.75 0 0 1 1.08 1.04l-4.25 4.25a.75.75 0 0 1-1.08 0L5.21 8.27a.75.75 0 0 1 .02-1.06Z" clip-rule="evenodd" />
            </svg>
          </span>
          {% blocktrans count notification_count=pending_notifications asvar notification_text %}
          Você tem {{ notification_count }} notificações pendentes
          {% plural %}
          Você tem {{ notification_count }} notificações pendentes
          {% endblocktrans %}
          <span class="sr-only" data-notification-sr>{{ notification_text }}</span>
        </button>
        <div
          id="notification-dropdown"
          class="notification-dropdown hidden absolute right-0 mt-2
                w-[calc(100vw-1rem)] sm:w-[25rem]
                max-w-[calc(100vw-1rem)]
                max-h-[28rem] overflow-y-auto
                bg-[var(--bg-primary)] border border-[var(--border)]
                rounded shadow-lg p-3 sm:p-4
                focus:outline-none"
          role="menu"
          aria-labelledby="notification-bell"
          aria-live="polite"
          tabindex="-1"
        >

        </div>
      </div>
      {% endwith %}
    {% if request.user.is_authenticated %}
      <a href="{% url 'accounts:perfil' %}" class="block w-8 h-8 rounded-full overflow-hidden shrink-0" aria-label="{% trans 'Perfil' %}">
      {% if request.user.avatar %}
      <img src="{{ request.user.avatar.url }}" alt="{{ request.user.username }}" class="w-full h-full object-cover" loading="lazy" />
      {% else %}
      <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
        <circle cx="12" cy="7" r="4" />
      </svg>
      {% endif %}
      <span class="sr-only">{% trans "Perfil" %}</span>
    </a>
    {% endif %}
  </div>
</header>
