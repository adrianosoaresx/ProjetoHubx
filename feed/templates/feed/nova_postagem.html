{% extends "base.html" %}
{% load static i18n widget_tweaks %}

{% block title %}{% trans "Nova Postagem" %} - Hubx{% endblock %}

{% block hero %}
  {% include '_components/hero_feed.html' with title=_('Nova Postagem') %}
{% endblock %}

{% block content %}

  {% if request.user.user_type == 'root' %}
    <p class="text-center text-[var(--text-muted)]">{% trans "Usuário root não tem acesso ao feed." %}</p>
  {% else %}

  <article class="card">
    <div class="card-header">
      <div class="flex flex-col gap-1 text-center">
        <h1 class="text-xl font-semibold text-[var(--text-primary)]">{% trans "Nova Postagem" %}</h1>
        <p class="text-sm text-[var(--text-secondary)]">{% trans "Compartilhe algo com sua comunidade" %}</p>
      </div>
    </div>
    <div class="card-body space-y-6">
      <div id="nova-postagem-form">
        <form method="post"
              action="{% url 'feed:nova_postagem' %}"
              hx-post="{% url 'feed:nova_postagem' %}"
              hx-target="#nova-postagem-form"
              hx-swap="outerHTML"
              hx-encoding="multipart/form-data"
              enctype="multipart/form-data"
              class="post-form space-y-6">
          {% csrf_token %}

          {% if form.non_field_errors %}
            <div class="rounded-xl border border-[var(--error)] bg-[var(--error-light)] p-3 text-sm text-[var(--error)]">
              <ul class="list-disc list-inside space-y-1">
                {% for error in form.non_field_errors %}
                  <li>{{ error }}</li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}

          <div class="space-y-4">
            {% include '_forms/field.html' with field=form.tipo_feed %}
            {% include '_forms/field.html' with field=form.organizacao %}
            {% include '_forms/field.html' with field=form.nucleo %}
            {% include '_forms/field.html' with field=form.evento %}
          </div>

          {% with placeholder_value=_('O que você gostaria de compartilhar?') %}
            {% with placeholder_attr='placeholder:'|add:placeholder_value %}
              {% with conteudo_field=form.conteudo|attr:'rows:6'|attr:placeholder_attr %}
                <div class="space-y-2">
                  {% include '_forms/field.html' with field=conteudo_field %}
                  <span id="char-count" class="text-xs text-[var(--text-muted)]"></span>
                  <p class="text-xs text-[var(--text-secondary)]">{% trans "Compartilhe ideias, atualizações ou conteúdos com sua rede." %}</p>
                </div>
              {% endwith %}
            {% endwith %}
          {% endwith %}

          {% if request.user.organizacao %}
            <input type="hidden" name="organizacao" value="{{ request.user.organizacao.id }}">
          {% endif %}

          <div class="space-y-4">
            {% include '_forms/field.html' with field=form.tags|attr:'id:tags-select' %}
            {% include '_forms/field.html' with id='id_tags_text' name='tags_text' label=_('Novas tags') placeholder=_('Digite novas tags separadas por vírgula') value=request.POST.tags_text|default:'' help_text=_('Use vírgula para separar as tags adicionais.') %}
          </div>

          <div class="space-y-4">
            {% include '_forms/field.html' with field=form.image %}
            {% include '_forms/field.html' with field=form.pdf %}
            {% include '_forms/field.html' with field=form.video %}
          </div>

          <p class="text-xs text-[var(--text-secondary)]">{% trans "Campos marcados com * são obrigatórios. Informe conteúdo ou anexe um arquivo." %}</p>

          <div class="flex justify-end gap-3 pt-4 border-t border-[var(--border)]">
            {% include '_components/cancel_button.html' with config=cancel_component_config href=back_href fallback_href=cancel_component_config.fallback_href %}
            <button type="submit" class="btn btn-primary" aria-label="{% trans 'Salvar' %}">
              {% trans "Salvar" %}
            </button>
          </div>
        </form>
      </div>
    </div>
  </article>

  <script src="{% static 'feed/js/feed.js' %}"></script>
  {% endif %}

{% endblock %}
