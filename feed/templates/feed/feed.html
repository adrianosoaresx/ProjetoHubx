{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "Feed" %} | Hubx{% endblock %}

{% block content %}
<section class="max-w-7xl mx-auto px-4 py-10">

  <!-- Cabeçalho -->
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold text-neutral-900">{% trans "Feed de Postagens" %}</h1>
    <div class="flex gap-2">
      <a href="{% url 'feed:meu_mural' %}" class="text-sm px-4 py-2 rounded-xl border border-neutral-300 text-neutral-700 hover:bg-neutral-100 focus:outline-none focus:ring-2 focus:ring-indigo-500" aria-label="{% trans 'Mural' %}">{% trans "Mural" %}</a>
      <a href="{% url 'feed:bookmarks' %}" class="text-sm px-4 py-2 rounded-xl border border-neutral-300 text-neutral-700 hover:bg-neutral-100 focus:outline-none focus:ring-2 focus:ring-indigo-500" aria-label="{% trans 'Favoritos' %}">{% trans "Favoritos" %}</a>
      {% if request.user.user_type != 'root' %}
        <a href="{% url 'feed:nova_postagem' %}" target="_blank" class="inline-flex items-center gap-2 rounded bg-emerald-600 px-4 py-2 text-white hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500" aria-label="{% trans 'Nova postagem' %}">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          {% trans "Nova postagem" %}
        </a>
      {% endif %}
    </div>
  </div>


  <form id="feed-filters" class="flex flex-wrap items-center gap-4 mb-4">
    <div>
      <label class="font-semibold" for="tipo-feed">{% trans "Tipo" %}:</label>
      <select id="tipo-feed" name="tipo_feed"
              hx-get="{% url 'feed:listar' %}"
              hx-target="#feed-grid"
              hx-trigger="change"
              hx-indicator="#feed-loading"
              hx-include="#feed-filters,#feed-search,#tags"
              class="rounded border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">
        <option value="global">{% trans "Global" %}</option>
        <option value="usuario">{% trans "Usuário" %}</option>
        <option value="nucleo">{% trans "Núcleo" %}</option>
        <option value="evento">{% trans "Evento" %}</option>
      </select>
    </div>
    <div>
      <label class="font-semibold" for="filtro-organizacao">{% trans "Organização" %}:</label>
      <select id="filtro-organizacao" name="organizacao"
              hx-get="{% url 'feed:listar' %}"
              hx-target="#feed-grid"
              hx-trigger="change"
              hx-indicator="#feed-loading"
              hx-include="#feed-filters,#feed-search,#tags"
              class="rounded border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">
        <option value="">{% trans "Selecione" %}</option>
        {% for o in organizacoes_do_usuario %}
          <option value="{{ o.id }}">{{ o.nome }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label class="font-semibold" for="filtro-nucleo">{% trans "Núcleo" %}:</label>
      <select id="filtro-nucleo" name="nucleo"
              hx-get="{% url 'feed:listar' %}"
              hx-target="#feed-grid"
              hx-trigger="change"
              hx-indicator="#feed-loading"
              hx-include="#feed-filters,#feed-search,#tags"
              class="rounded border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">
        <option value="">{% trans "Global" %}</option>
        {% for n in nucleos_do_usuario %}
          <option value="{{ n.id }}">{{ n.nome }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label class="font-semibold" for="filtro-evento">{% trans "Evento" %}:</label>
      <select id="filtro-evento" name="evento"
              hx-get="{% url 'feed:listar' %}"
              hx-target="#feed-grid"
              hx-trigger="change"
              hx-indicator="#feed-loading"
              hx-include="#feed-filters,#feed-search,#tags"
              class="rounded border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">
        <option value="">{% trans "Selecione" %}</option>
        {% for e in eventos_do_usuario %}
          <option value="{{ e.id }}">{{ e.titulo }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label class="font-semibold" for="date-from">{% trans "De" %}:</label>
      <input type="date" id="date-from" name="date_from"
             hx-get="{% url 'feed:listar' %}"
             hx-target="#feed-grid"
             hx-trigger="change"
             hx-indicator="#feed-loading"
             hx-include="#feed-filters,#feed-search,#tags"
             class="rounded border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">
    </div>
    <div>
      <label class="font-semibold" for="date-to">{% trans "Até" %}:</label>
      <input type="date" id="date-to" name="date_to"
             hx-get="{% url 'feed:listar' %}"
             hx-target="#feed-grid"
             hx-trigger="change"
             hx-indicator="#feed-loading"
             hx-include="#feed-filters,#feed-search,#tags"
             class="rounded border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">
    </div>
  </form>


  <div class="flex items-center gap-4 mb-4">
    <label class="font-semibold">{% trans "Tags" %}:</label>
    <select id="tags-select" multiple class="rounded border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500"
            hx-get="{% url 'feed:listar' %}"
            hx-target="#feed-grid"
            hx-indicator="#feed-loading"
            hx-include="#feed-search,#feed-filters,#tags">
      {% for tag in tags_disponiveis %}
        <option value="{{ tag.nome }}">{{ tag.nome }}</option>
      {% endfor %}
    </select>
    <input type="hidden" id="tags" name="tags">
  </div>

  <input type="search" name="q" id="feed-search"
         placeholder="{% trans 'Buscar postagens…' %}"
         hx-get="{% url 'feed:listar' %}"
         hx-trigger="keyup changed delay:500ms"
         hx-target="#feed-grid"
         hx-include="#feed-filters,#tags"
         class="w-full rounded border-gray-300 mb-6 focus:outline-none focus:ring-2 focus:ring-indigo-500">

  <div id="feed-loading" class="htmx-indicator">{% trans "Carregando…" %}</div>

  {% include "feed/_grid.html" %}

</section>
<script src="{% static 'feed/js/feed.js' %}"></script>
{% endblock %}
