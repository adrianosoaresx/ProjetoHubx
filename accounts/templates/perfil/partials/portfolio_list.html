{% load i18n lucide_icons %}


  <div class="card-header">
    <div>
      <h2 class="text-xl font-semibold text-[var(--text-primary)]">{% trans "Portfólio" %}</h2>
      <p class="text-sm text-[var(--text-secondary)]">{% trans "Gerencie suas imagens, vídeos e documentos" %}</p>
    </div>
  </div>
  <div class="card-body space-y-4 sm:space-y-6">
    {% if show_form %}
      <form
        id="formPortfolio"
        class="space-y-4 sm:space-y-6"
        method="post"
        action="{% url 'accounts:perfil_sections_portfolio' %}"
        enctype="multipart/form-data"
      >
        {% csrf_token %}
        {% if messages %}
          {% for message in messages %}
            {% if 'success' in message.tags %}
              {% with alert_class='alert alert-success' alert_role='status' %}
                <div class="{{ alert_class }}" role="{{ alert_role }}">{{ message }}</div>
              {% endwith %}
            {% elif 'error' in message.tags or 'danger' in message.tags %}
              {% with alert_class='alert alert-error' alert_role='alert' %}
                <div class="{{ alert_class }}" role="{{ alert_role }}">{{ message }}</div>
              {% endwith %}
            {% elif 'warning' in message.tags %}
              {% with alert_class='alert alert-warning' alert_role='alert' %}
                <div class="{{ alert_class }}" role="{{ alert_role }}">{{ message }}</div>
              {% endwith %}
            {% else %}
              {% with alert_class='alert alert-info' alert_role='status' %}
                <div class="{{ alert_class }}" role="{{ alert_role }}">{{ message }}</div>
              {% endwith %}
            {% endif %}
          {% endfor %}
        {% endif %}
        {% if form.non_field_errors %}
          <div class="alert alert-error" role="alert">
            {{ form.non_field_errors }}
          </div>
        {% endif %}
        {% for field in form %}
          {% include '_forms/field.html' with field=field %}
        {% endfor %}
        <div class="flex justify-end gap-2 pt-4 border-t border-[var(--border)] sm:gap-3">
          <button type="submit" class="btn btn-primary">
            {% trans "Enviar" %}
          </button>
        </div>
      </form>
    {% else %}
      {% if is_owner %}
        <div class="flex justify-end gap-2 sm:gap-3">
          <a href="{% url 'accounts:perfil_sections_portfolio' %}?adicionar=1" class="btn btn-primary">
            {% trans "Adicionar" %}
          </a>
        </div>
      {% endif %}

      {% if filter_form %}
        <form method="get" class="space-y-3 sm:space-y-4">
          {% include '_forms/field.html' with field=filter_form.q %}
        </form>
      {% endif %}

      <div class="card-grid gap-4 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-2 sm:gap-6">
        {% for media in medias %}
          <article class="card p-0">
            <div class="card-body relative space-y-3 sm:space-y-4">
              {% if is_owner %}
                <div class="absolute right-0 top-0 z-10 flex gap-2 sm:gap-3">
                  <a
                    href="{% url 'accounts:perfil_sections_portfolio_edit' media.pk %}"
                    class="btn btn-secondary btn-sm"
                    aria-label="{% trans 'Editar' %}"
                    hx-get="{% url 'accounts:perfil_sections_portfolio_edit' media.pk %}"
                    hx-target="#perfil-content"
                    hx-push-url="?section=portfolio&amp;portfolio_view=edit&amp;media={{ media.pk }}"
                  >
                    {% lucide 'pencil' class='w-4 h-4' aria_hidden='true' %}
                  </a>
                  <a
                    href="{% url 'accounts:perfil_sections_portfolio_delete' media.pk %}"
                    class="btn btn-danger btn-sm"
                    aria-label="{% trans 'Excluir' %}"
                    hx-get="{% url 'accounts:portfolio_delete' media.pk %}"
                    hx-target="#modal"
                    hx-trigger="click"
                    hx-swap="innerHTML"
                    hx-on="htmx:beforeRequest: window.HubxModalTrigger = this;"
                  >
                    {% lucide 'trash' class='w-4 h-4' aria_hidden='true' %}
                  </a>
                </div>
              {% endif %}

              {% if media.media_type == 'pdf' %}
                <a
                  href="{{ media.file.url }}"
                  class="block"
                  target="_blank"
                  rel="noopener"
                  aria-label="{% trans 'Abrir PDF em uma nova aba' %}"
                >
                  <div class="aspect-video overflow-hidden rounded-lg bg-[var(--bg-tertiary)]">
                    <span class="flex h-full w-full items-center justify-center gap-3 text-[var(--text-primary)]">
                      <span class="flex h-16 w-16 items-center justify-center rounded-full bg-[var(--bg-secondary)]">
                        {% lucide 'file-text' class='h-8 w-8' aria_hidden='true' %}
                      </span>
                      <span class="text-sm font-medium">{% trans "Visualizar PDF" %}</span>
                    </span>
                  </div>
                </a>
              {% else %}
                <a href="{% url 'accounts:perfil_sections_portfolio_detail' media.pk %}" class="block">
                  <div class="aspect-video overflow-hidden rounded-lg bg-[var(--bg-tertiary)]">
                    {% if media.media_type == 'image' %}
                      <img src="{{ media.file.url }}" alt="{{ media.descricao }}" class="h-full w-full object-cover" loading="lazy">
                    {% elif media.media_type == 'video' %}
                      <video src="{{ media.file.url }}" class="h-full w-full object-cover" controls></video>
                    {% else %}
                      <span class="flex h-full items-center justify-center text-sm text-[var(--text-primary)]">{{ media.file.name }}</span>
                    {% endif %}
                  </div>
                </a>
              {% endif %}

              <div class="space-y-2 sm:space-y-3">
                <p class="text-sm font-medium text-[var(--text-primary)]">{{ media.descricao }}</p>
                <p class="text-xs text-[var(--text-secondary)]">{{ media.created_at|date:"SHORT_DATETIME_FORMAT" }}</p>
                {% if media.tags.all %}
                  <div class="flex flex-wrap gap-2">
                    {% for tag in media.tags.all %}
                      <span class="rounded bg-[var(--bg-secondary)] px-2 py-0.5 text-xs text-[var(--text-secondary)]">{{ tag.nome }}</span>
                    {% endfor %}
                  </div>
                {% endif %}
              </div>
            </div>
          </article>
        {% empty %}
          <p class="text-sm text-[var(--text-secondary)]">{% trans "Nenhum arquivo enviado." %}</p>
        {% endfor %}
      </div>
    {% endif %}
  
</article>
<div id="modal" role="presentation" aria-live="polite"></div>
