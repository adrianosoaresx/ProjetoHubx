{% extends 'base.html' %}
{% load i18n %}
{% block title %}{% trans "Meu Perfil" %} | Hubx{% endblock %}

{% block hero %}
  {% include "_components/hero_profile.html" with profile=user %}
{% endblock %}

{% block content %}
<section class="container mx-auto px-4">
  <div class="card">
    <nav class="border-b border-[var(--border)]">
      <ul role="tablist" aria-label="{% trans 'Navegação do perfil' %}" class="-mb-px flex gap-6">
        <li>
          <a id="tab-informacoes" href="#tab-informacoes-panel" role="tab" aria-selected="true" class="py-3 text-sm font-medium border-b-2 border-primary text-[var(--text-primary)]">{% trans 'Informações' %}</a>
        </li>
        {% if user.get_tipo_usuario != 'admin' %}
        <li>
          <a id="tab-empresas" href="#tab-empresas-panel" role="tab" aria-selected="false" class="py-3 text-sm font-medium border-b-2 border-transparent text-[var(--text-secondary)]">{% trans 'Empresas' %}</a>
        </li>
        <li>
          <a id="tab-nucleos" href="#tab-nucleos-panel" role="tab" aria-selected="false" class="py-3 text-sm font-medium border-b-2 border-transparent text-[var(--text-secondary)]">{% trans 'Núcleos' %}</a>
        </li>
        <li>
          <a id="tab-eventos" href="#tab-eventos-panel" role="tab" aria-selected="false" class="py-3 text-sm font-medium border-b-2 border-transparent text-[var(--text-secondary)]">{% trans 'Eventos' %}</a>
        </li>
        {% endif %}
      </ul>
    </nav>
    <div class="card-body">
      <section id="tab-informacoes-panel" class="mt-6">
        {% if user.biografia %}
          <div class="mb-6">
            <p class="text-[var(--text-primary)] italic border-l-4 border-primary pl-4">{{ user.biografia }}</p>
          </div>
        {% endif %}

        <div class="card-grid text-sm text-[var(--text-primary)]">
          <article class="card">
            <div class="card-body">
              <h4 class="font-medium mb-1">{% trans "Contato" %}</h4>
              <p>{% trans "Email" %}: {{ user.email }}</p>
              <p>{% trans "Telefone" %}: {{ user.phone_number }}</p>
              <p>{% trans "WhatsApp" %}: {{ user.whatsapp }}</p>
            </div>
          </article>
          <article class="card">
            <div class="card-body">
              <h4 class="font-medium mb-1">{% trans "Localização" %}</h4>
              <p>{{ user.endereco }}</p>
              <p>{{ user.cidade }} - {{ user.estado }}</p>
              <p>{{ user.cep }}</p>
            </div>
          </article>
          <article class="card">
            <div class="card-body">
              <h4 class="font-medium mb-1">{% trans "Redes Sociais" %}</h4>
              {% if user.redes_sociais %}
                {% for nome, link in user.redes_sociais.items %}
                  <p><a href="{{ link }}" class="text-primary hover:underline" target="_blank">{{ nome|title }}</a></p>
                {% endfor %}
              {% endif %}
            </div>
          </article>
        </div>

        <div class="mt-6 text-right">
          <a href="{% url 'accounts:informacoes_pessoais' %}" class="text-primary font-medium hover:underline">{% trans "Editar perfil" %}</a>
        </div>
      </section>

      {% if user.get_tipo_usuario != 'admin' %}
      <section id="tab-empresas-panel" class="mt-6" hidden>
        <div class="card-grid">
          {% for empresa in empresas %}
            {% include '_components/card_empresa.html' with empresa=empresa %}
          {% empty %}
            <p class="text-sm text-[var(--text-secondary)]">{% trans "Nenhuma empresa encontrada." %}</p>
          {% endfor %}
        </div>
      </section>

      <section id="tab-nucleos-panel" class="mt-6" hidden>
        <div class="card-grid">
          {% for nucleo in nucleos %}
            {% include '_components/card_nucleo.html' with nucleo=nucleo %}
          {% empty %}
            <p class="text-sm text-[var(--text-secondary)]">{% trans "Nenhum núcleo encontrado." %}</p>
          {% endfor %}
        </div>
      </section>

      <section id="tab-eventos-panel" class="mt-6" hidden>
        <div class="card-grid">
          {% for ins in inscricoes %}
            {% include '_components/card_evento.html' with evento=ins.evento %}
          {% empty %}
            <p class="text-sm text-[var(--text-secondary)]">{% trans "Nenhum evento encontrado." %}</p>
          {% endfor %}
        </div>
      </section>
      {% endif %}
    </div>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  const tabs = document.querySelectorAll('[role="tab"]');
  tabs.forEach(tab => {
    tab.addEventListener('click', ev => {
      ev.preventDefault();
      tabs.forEach(t => {
        const selected = t === tab;
        t.setAttribute('aria-selected', selected);
        t.classList.toggle('border-primary', selected);
        t.classList.toggle('text-[var(--text-primary)]', selected);
        t.classList.toggle('border-transparent', !selected);
        t.classList.toggle('text-[var(--text-secondary)]', !selected);
        const panel = document.getElementById(t.getAttribute('href').substring(1));
        if (panel) {
          panel.toggleAttribute('hidden', !selected);
        }
      });
    });
  });
</script>
{% endblock %}
