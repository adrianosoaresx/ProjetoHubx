{% extends 'base.html' %}
{% load static i18n lucide_icons %}
{% block title %}{{ perfil.display_name }} | Hubx{% endblock %}

{% block hero %}
  {% include '_components/hero_profile.html' with profile=perfil is_owner=is_owner hero_title=hero_title hero_subtitle=hero_subtitle %}
{% endblock %}

{% block content %}
<div class="space-y-6">
  <details class="card group">
    <summary class="card-header flex items-center justify-between gap-4 cursor-pointer">
      <div class="flex items-start gap-3">
        <span
          class="flex h-12 w-12 items-center justify-center rounded-full bg-[var(--color-info-500)]/10 text-[var(--color-info-600)] shadow-lg shadow-[var(--color-info-500)]/20"
        >
          {% lucide 'contact' class='h-6 w-6' aria_hidden='true' %}
        </span>
        <div class="space-y-1">
          <p class="text-xl font-semibold">{% trans "Informações públicas" %}</p>
          <p class="text-sm text-[var(--text-secondary)]">
            {% blocktrans with profile_name=perfil.display_name %}
              Dados compartilhados por {{ profile_name }} para visitantes.
            {% endblocktrans %}
          </p>
        </div>
      </div>
      <span class="text-[var(--text-secondary)] transition-transform duration-200 group-open:-rotate-180">
        {% lucide 'chevron-down' class='w-5 h-5' aria_hidden='true' %}
      </span>
    </summary>

    <div class="card-body">
      <section
        id="perfil-info"
        class="space-y-6"
        data-perfil-mode="public"
        data-perfil-username="{{ perfil.username }}"
        data-perfil-public-id="{{ perfil.public_id }}"
        aria-live="polite"
        aria-busy="true"
        hx-trigger="load"
        hx-get="{% url 'accounts:perfil_info_partial' %}"
        hx-target="#perfil-info"
        hx-vals='{"public_id":"{{ perfil.public_id|escapejs }}","username":"{{ perfil.username|escapejs }}"}'
      >
        <div class="py-6 text-center text-sm text-[var(--text-secondary)]" data-perfil-placeholder>
          {% trans "Carregando conteúdo..." %}
        </div>
      </section>
    </div>
  </details>

  <details class="card group">
    <summary class="card-header flex items-center justify-between gap-4 cursor-pointer">
      <div class="flex items-start gap-3">
        <span
          class="flex h-12 w-12 items-center justify-center rounded-full bg-[var(--color-warning-500)]/10 text-[var(--color-warning-600)] shadow-lg shadow-[var(--color-warning-500)]/20"
        >
          {% lucide 'briefcase' class='h-6 w-6' aria_hidden='true' %}
        </span>
        <div class="space-y-1">
          <p class="text-xl font-semibold">{% trans "Portfólio" %}</p>
          <p class="text-sm text-[var(--text-secondary)]">
            {% blocktrans with profile_name=perfil.display_name %}
              Trabalhos e mídias que {{ profile_name }} compartilha publicamente.
            {% endblocktrans %}
          </p>
        </div>
      </div>
      <span class="text-[var(--text-secondary)] transition-transform duration-200 group-open:-rotate-180">
        {% lucide 'chevron-down' class='w-5 h-5' aria_hidden='true' %}
      </span>
    </summary>

    <div class="card-body">
      {% if portfolio_medias %}
        <div class="card-grid gap-6 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2">
          {% for media in portfolio_medias %}
            <article class="card p-0">
              <div class="card-body relative space-y-5">
                <header class="space-y-2">
                  <p class="text-sm font-medium text-[var(--text-primary)]">
                    {{ media.descricao|default:_('Mídia sem descrição') }}
                  </p>
                  {% if media.created_at %}
                    <p class="text-xs text-[var(--text-secondary)]">
                      {{ media.created_at|date:"SHORT_DATETIME_FORMAT" }}
                    </p>
                  {% endif %}
                </header>

                {% if media.media_type == 'pdf' %}
                  <div class="relative z-20 overflow-hidden rounded-xl border border-[var(--border)] bg-[var(--bg-tertiary)]">
                    <a
                      href="{{ media.file.url }}"
                      class="flex items-center justify-between gap-4 p-4 text-sm font-medium text-[var(--text-primary)] transition hover:text-[var(--accent)]"
                      target="_blank"
                      rel="noopener noreferrer"
                    >
                      <span class="flex items-center gap-3">
                        <span class="flex h-12 w-12 items-center justify-center rounded-xl bg-[var(--bg-secondary)] text-[var(--primary)]">
                          {% lucide 'file-text' class='h-6 w-6' aria_hidden='true' %}
                        </span>
                        <span class="truncate">{% trans "Visualizar PDF" %}</span>
                      </span>
                      {% lucide 'external-link' class='h-5 w-5 flex-shrink-0 text-[var(--text-secondary)]' aria_hidden='true' %}
                    </a>
                  </div>
                {% elif media.media_type == 'image' %}
                  <a href="{{ media.file.url }}" class="block" target="_blank" rel="noopener noreferrer">
                    <figure class="relative z-20 overflow-hidden rounded-xl border border-[var(--border)] bg-[var(--bg-tertiary)]">
                      <div class="relative flex max-h-[320px] w-full items-center justify-center overflow-hidden bg-[var(--bg-secondary)]">
                        <img
                          src="{{ media.file.url }}"
                          alt="{{ media.descricao|default:_('Mídia sem descrição') }}"
                          class="h-auto w-full max-h-[320px] object-contain"
                          loading="lazy"
                        />
                      </div>
                    </figure>
                  </a>
                {% elif media.media_type == 'video' %}
                  <figure class="relative z-20 overflow-hidden rounded-xl border border-[var(--border)] bg-black">
                    <div class="feed-video-wrapper">
                      <div class="feed-video-frame">
                        <video src="{{ media.file.url }}" controls class="feed-video-player"></video>
                      </div>
                    </div>
                  </figure>
                {% else %}
                  <div class="relative z-20 overflow-hidden rounded-xl border border-[var(--border)] bg-[var(--bg-tertiary)] p-4 text-sm text-[var(--text-primary)]">
                    {{ media.file.name|default:_('Arquivo disponível') }}
                  </div>
                {% endif %}

                <footer class="space-y-2">
                  <a
                    href="{{ media.file.url }}"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="inline-flex items-center gap-2 text-sm font-medium text-[var(--color-primary-600)] transition hover:text-[var(--color-primary-700)]"
                  >
                    {% lucide 'external-link' class='h-4 w-4' aria_hidden='true' %}
                    {% trans "Abrir mídia" %}
                  </a>

                  {% if media.tags.all %}
                    <div class="flex flex-wrap gap-2">
                      {% for tag in media.tags.all %}
                        <span class="rounded bg-[var(--bg-secondary)] px-2 py-0.5 text-xs text-[var(--text-secondary)]">{{ tag.nome }}</span>
                      {% endfor %}
                    </div>
                  {% endif %}
                </footer>
              </div>
            </article>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-sm text-[var(--text-secondary)]">
          {% trans "Nenhuma mídia pública foi adicionada ao portfólio." %}
        </p>
      {% endif %}
    </div>
  </details>
</div>

{% endblock %}

{% block scripts %}
  {{ block.super }}
  <script type="module" src="{% static 'perfil/js/perfil.js' %}"></script>
{% endblock %}
