{% load i18n l10n %}
<div class="p-4 bg-[var(--bg-secondary)] rounded card max-w-md">
  <h2 class="text-lg font-semibold mb-4">{% trans 'Confirmar solicitação de participação?' %}</h2>
  <form hx-post="{% url 'nucleos_api:nucleo-solicitar' nucleo.pk %}"
        hx-swap="none"
        hx-on="htmx:afterRequest: handleSolicitar(event)">
    {% csrf_token %}

    <p class="mb-4">{% trans 'Mensalidade' %}: {{ nucleo.mensalidade|localize }}</p>

    <p class="mb-4 text-sm text-[var(--text-secondary)]">
      {% blocktrans with mensalidade=nucleo.mensalidade|floatformat:2 %}
        Ao confirmar, você concorda com o pagamento da mensalidade de R$ {{ mensalidade }} e com os efeitos da adesão ao núcleo.
      {% endblocktrans %}
    </p>

    <p id="solicitar-error" class="mb-4 text-sm text-[var(--error)] hidden"></p>

    <div class="flex justify-end gap-2">
      <button type="button" class="btn btn-secondary" hx-on="click: document.getElementById('modal').innerHTML=''">{% trans 'Cancelar' %}</button>
      <button type="submit" class="btn btn-primary">{% trans 'Confirmar' %}</button>
    </div>
  </form>
</div>

<script>
function handleSolicitar(event) {
  if (event.detail.xhr.status === 201) {
    document.getElementById('solicitar-btn').outerHTML = '<p class="text-[var(--success)]">{% trans "Solicitação enviada" %}</p>';
    document.getElementById('modal').innerHTML = '';
  } else {
    const errorEl = document.getElementById('solicitar-error');
    if (errorEl) {
      errorEl.textContent = "{% trans 'Erro ao enviar solicitação' %}";
      errorEl.classList.remove('hidden');
    }
  }
}
</script>
