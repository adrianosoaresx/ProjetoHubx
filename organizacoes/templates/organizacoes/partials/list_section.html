{% load i18n %}
<!-- Cabeçalho -->
<div class="flex items-center justify-between mb-8">
  <div>
    <h1 class="text-2xl font-bold text-neutral-900">{% trans 'Organizações' %}</h1>
    <p class="text-neutral-600 text-sm">{% trans 'Gerencie as organizações cadastradas' %}</p>
  </div>
  <a href="{% url 'organizacoes:create' %}" class="inline-flex items-center gap-2 bg-primary-600 text-white text-sm px-4 py-2 rounded-xl hover:bg-primary-700">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <line x1="12" y1="5" x2="12" y2="19"/>
      <line x1="5" y1="12" x2="19" y2="12"/>
    </svg>
    {% trans 'Nova Organização' %}
  </a>
</div>

<form hx-get="{% url 'organizacoes:list' %}" hx-target="#org-list" hx-push-url="true" class="mb-6 grid md:grid-cols-5 gap-2">
  <select name="tipo" class="w-full p-2 border rounded-lg">
    <option value="">{% trans 'Tipo' %}</option>
    {% for value, label in tipos %}
      <option value="{{ value }}" {% if request.GET.tipo == value %}selected{% endif %}>{{ label }}</option>
    {% endfor %}
  </select>
  <select name="cidade" class="w-full p-2 border rounded-lg">
    <option value="">{% trans 'Cidade' %}</option>
    {% for c in cidades %}
      <option value="{{ c }}" {% if request.GET.cidade == c %}selected{% endif %}>{{ c }}</option>
    {% endfor %}
  </select>
  <select name="estado" class="w-full p-2 border rounded-lg">
    <option value="">{% trans 'Estado' %}</option>
    {% for e in estados %}
      <option value="{{ e }}" {% if request.GET.estado == e %}selected{% endif %}>{{ e }}</option>
    {% endfor %}
  </select>
  <select name="inativa" class="w-full p-2 border rounded-lg">
    <option value="">{% trans 'Status' %}</option>
    <option value="false" {% if inativa == 'false' %}selected{% endif %}>{% trans 'Ativas' %}</option>
    <option value="true" {% if inativa == 'true' %}selected{% endif %}>{% trans 'Inativas' %}</option>
  </select>
  <select name="ordering" class="w-full p-2 border rounded-lg">
    <option value="nome" {% if request.GET.ordering == 'nome' or not request.GET.ordering %}selected{% endif %}>{% trans 'Nome' %}</option>
    <option value="tipo" {% if request.GET.ordering == 'tipo' %}selected{% endif %}>{% trans 'Tipo' %}</option>
    <option value="cidade" {% if request.GET.ordering == 'cidade' %}selected{% endif %}>{% trans 'Localização' %}</option>
    <option value="created_at" {% if request.GET.ordering == 'created_at' %}selected{% endif %}>{% trans 'Data' %}</option>
  </select>
  <div class="md:col-span-5 flex justify-end">
    <button type="submit" class="px-4 py-2 bg-primary-600 text-white rounded-lg">{% trans 'Filtrar' %}</button>
  </div>
</form>

{% if object_list %}
  <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
    {% for organizacao in object_list %}
    <div class="bg-white border border-neutral-200 rounded-2xl shadow-sm p-4 flex flex-col">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-12 h-12 bg-neutral-100 rounded-xl flex items-center justify-center overflow-hidden" {% if not organizacao.avatar %}role="img" aria-label="{{ organizacao.nome }}"{% endif %}>
          {% if organizacao.avatar %}
            <img src="{{ organizacao.avatar.url }}" alt="{{ organizacao.nome }}" class="w-full h-full object-cover rounded-xl" />
          {% else %}
            <span class="text-sm font-bold text-neutral-500">{{ organizacao.nome|make_list|first|upper }}</span>
          {% endif %}
        </div>
        <div>
          <a href="{% url 'organizacoes:detail' organizacao.id %}" class="text-neutral-900 font-medium hover:underline">{{ organizacao.nome }}</a>
          {% if organizacao.inativa %}
            <span class="ml-2 text-xs bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded">{% trans 'Inativa' %}</span>
          {% endif %}
        </div>
      </div>
      <div class="grid grid-cols-3 gap-4 text-center mt-auto">
        <div>
          <p class="text-xs text-neutral-500">{% trans 'Usuários' %}</p>
          <p class="text-lg font-semibold text-neutral-900">{{ organizacao.users_count }}</p>
        </div>
        <div>
          <p class="text-xs text-neutral-500">{% trans 'Núcleos' %}</p>
          <p class="text-lg font-semibold text-neutral-900">{{ organizacao.nucleos_count }}</p>
        </div>
        <div>
          <p class="text-xs text-neutral-500">{% trans 'Eventos' %}</p>
          <p class="text-lg font-semibold text-neutral-900">{{ organizacao.events_count }}</p>
        </div>
      </div>
      <div class="mt-4 flex gap-2 justify-center">
        <a href="{% url 'organizacoes:detail' organizacao.id %}" class="text-blue-600 hover:underline" aria-label="{% trans 'Visualizar' %}">{% trans 'Visualizar' %}</a>
        {% if perms.organizacoes.change_organizacao %}
        <a href="{% url 'organizacoes:update' organizacao.id %}" class="text-yellow-700 hover:underline" aria-label="{% trans 'Editar' %}">{% trans 'Editar' %}</a>
        {% endif %}
        {% if request.user.user_type == 'root' %}
          {% if perms.organizacoes.delete_organizacao %}
          <a href="{% url 'organizacoes:delete' organizacao.id %}" class="text-red-700 hover:underline" aria-label="{% trans 'Remover' %}" hx-confirm="{% trans 'Confirmar remoção?' %}">{% trans 'Remover' %}</a>
          {% endif %}
          <form method="post" action="{% url 'organizacoes:toggle' organizacao.id %}" hx-confirm="{% trans 'Tem certeza?' %}">
            {% csrf_token %}
            {% if organizacao.inativa %}
              <button type="submit" class="text-neutral-700 hover:underline" aria-label="{% trans 'Reativar' %}">{% trans 'Reativar' %}</button>
            {% else %}
              <button type="submit" class="text-neutral-700 hover:underline" aria-label="{% trans 'Inativar' %}">{% trans 'Inativar' %}</button>
            {% endif %}
          </form>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
  <div class="mt-6 flex justify-center gap-2">
    {% if page_obj.has_previous %}
      <a hx-get="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.tipo %}&tipo={{ request.GET.tipo }}{% endif %}{% if request.GET.cidade %}&cidade={{ request.GET.cidade }}{% endif %}{% if request.GET.estado %}&estado={{ request.GET.estado }}{% endif %}{% if request.GET.ordering %}&ordering={{ request.GET.ordering }}{% endif %}{% if inativa %}&inativa={{ inativa }}{% endif %}" hx-target="#org-list" hx-push-url="true" class="px-3 py-1 border rounded" aria-label="{% trans 'Anterior' %}">{% trans 'Anterior' %}</a>
    {% endif %}
    <span class="px-3 py-1">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a hx-get="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.tipo %}&tipo={{ request.GET.tipo }}{% endif %}{% if request.GET.cidade %}&cidade={{ request.GET.cidade }}{% endif %}{% if request.GET.estado %}&estado={{ request.GET.estado }}{% endif %}{% if request.GET.ordering %}&ordering={{ request.GET.ordering }}{% endif %}{% if inativa %}&inativa={{ inativa }}{% endif %}" hx-target="#org-list" hx-push-url="true" class="px-3 py-1 border rounded" aria-label="{% trans 'Próxima' %}">{% trans 'Próxima' %}</a>
    {% endif %}
  </div>
{% else %}
  <div class="text-center border border-neutral-200 rounded-2xl shadow-sm p-10 bg-white">
    <p class="text-neutral-500 mb-4">{% trans 'Nenhuma organização cadastrada.' %}</p>
    <a href="{% url 'organizacoes:create' %}" class="inline-block text-sm px-4 py-2 rounded-xl bg-primary-600 text-white hover:bg-primary-700">
      {% trans 'Cadastrar' %}
    </a>
  </div>
{% endif %}
