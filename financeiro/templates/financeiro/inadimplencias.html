{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Inadimplências" %}{% endblock %}

{% block content %}
<section class="p-4 max-w-6xl mx-auto">
  <h1 class="text-2xl font-semibold mb-2">{% trans "Inadimplências" %}</h1>
  <form id="inad-form" class="mb-4 grid grid-cols-1 md:grid-cols-4 gap-4" hx-get="/api/financeiro/inadimplencias/" hx-target="#lista" hx-swap="none" hx-trigger="change from:select,change from:input, load" hx-on="htmx:afterRequest: renderInadimplencias(event)">
    <legend class="sr-only">{% trans "Filtros" %}</legend>
    <div>
      <label for="filtro-centro" class="block text-sm font-medium text-gray-700">{% trans "Centro de Custo" %}</label>
      <select id="filtro-centro" name="centro" class="border p-2 rounded">
        <option value="">{% trans "Todos Centros" %}</option>
        {% for c in centros %}
          <option value="{{ c.id }}">{{ c.nome }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label for="filtro-nucleo" class="block text-sm font-medium text-gray-700">{% trans "Núcleo" %}</label>
      <select id="filtro-nucleo" name="nucleo" class="border p-2 rounded">
        <option value="">{% trans "Todos Núcleos" %}</option>
        {% for n in nucleos %}
          <option value="{{ n.id }}">{{ n.nome }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label for="filtro-status" class="block text-sm font-medium text-gray-700">{% trans "Status" %}</label>
      <select id="filtro-status" name="status" class="border p-2 rounded" disabled>
        <option>{% trans "Pendente" %}</option>
      </select>
    </div>
    <div>
      <label for="filtro-periodo" class="block text-sm font-medium text-gray-700">{% trans "Período" %}</label>
      <input id="filtro-periodo" type="month" name="periodo" class="border p-2 rounded" />
    </div>
  </form>
  <div id="lista" aria-live="polite">
    <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-[var(--border)]">
      <thead class="bg-[var(--bg-secondary)]">
        <tr>
          <th class="px-3 py-2 text-left text-xs font-medium text-[var(--text-secondary)]">{% trans "ID" %}</th>
          <th class="px-3 py-2 text-left text-xs font-medium text-[var(--text-secondary)]">{% trans "Centro de Custo" %}</th>
          <th class="px-3 py-2 text-left text-xs font-medium text-[var(--text-secondary)]">{% trans "Conta" %}</th>
          <th class="px-3 py-2 text-left text-xs font-medium text-[var(--text-secondary)]">{% trans "Valor" %}</th>
          <th class="px-3 py-2 text-left text-xs font-medium text-[var(--text-secondary)]">{% trans "Data de Vencimento" %}</th>
          <th class="px-3 py-2 text-left text-xs font-medium text-[var(--text-secondary)]">{% trans "Dias em atraso" %}</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-[var(--border)]"></tbody>
    </table>
    </div>
  </div>
  <script>
    function renderInadimplencias(evt) {
      const data = JSON.parse(evt.detail.xhr.response);
      const tbody = document.querySelector('#lista tbody');
      tbody.innerHTML = data.map(r => `<tr><td class=\"px-3 py-2\">${r.id}</td><td class=\"px-3 py-2\">${r.centro || ''}</td><td class=\"px-3 py-2\">${r.conta || ''}</td><td class=\"px-3 py-2\">${r.valor}</td><td class=\"px-3 py-2\">${r.data_vencimento}</td><td class=\"px-3 py-2\">${r.dias_atraso}</td></tr>`).join('');
    }
  </script>
</section>

{% endblock %}

